!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e=e||self)["vue-yandex-maps"]={},e.vue)}(this,function(e,t){"use strict";function o(t,e){var o,n=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)),n}function n(n){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){var t,o;t=n,o=r[e=e],e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(o="Object"===o&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?a(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function l(e,t){var o,i=t.options,s=t.callbacks,c=t.map,l=t.useObjectManager,u=t.objectManagerClusterize,d=t.useHtmlInLayout?'\n    <div v-html="properties.balloonContentHeader"></div>\n    <div v-html="properties.balloonContentBody"></div>\n    <div v-html="properties.balloonContentFooter"></div>\n  ':"\n    <div>{{ properties.balloonContentHeader }}</div>\n    <div>{{ properties.balloonContentBody }}</div>\n    <div>{{ properties.balloonContentFooter }}</div>\n  ",p={},n=[];e.forEach(function(e){e.clusterName?p[e.clusterName]=p[e.clusterName]?[].concat(m(p[e.clusterName]),[e]):[e]:n.push(e)}),Object.keys(p).forEach(function(e){var t,o,n=i[e]||{},r=s[e]||{},a=n.layout||d,a=(n.clusterBalloonItemContentLayout=ymaps.templateLayoutFactory.createClass(a),n.clusterBalloonLayout||n.clusterLayout),a=(delete n.clusterBalloonLayout,a?ymaps.templateLayoutFactory.createClass(a):n.clusterBalloonContentLayout||"cluster#balloonTwoColumns"),a=(n.clusterBalloonContentLayout=a,n.clusterIconContentLayout);n.clusterIconContentLayout=a&&ymaps.templateLayoutFactory.createClass(a),l?(t=new ymaps.ObjectManager(Object.assign({clusterize:u},n)),Object.keys(r).forEach(function(e){t.clusters.events.add(e,r[e])}),t.add(p[e]),c.geoObjects.add(t)):(o=new ymaps.Clusterer(n),Object.keys(r).forEach(function(e){o.events.add(e,r[e])}),n.createCluster&&(o.createCluster=n.createCluster),o.add(p[e]),c.geoObjects.add(o))}),n.length&&(o=l?new ymaps.ObjectManager({clusterize:!1}):new ymaps.GeoObjectCollection,n.forEach(function(e){return o.add(e)}),c.geoObjects.add(o))}function p(e){return e.charAt(0).toUpperCase()+e.slice(1)}function d(e,t){var a=[];return function e(t,o){if(t===o)return 1;if(t instanceof Date&&o instanceof Date)return+t==+o;if("object"===i(t)&&"object"===i(o)){if(function(e,t){for(var o=a.length;o--;)if(!(a[o][0]!==e&&a[o][0]!==t||a[o][1]!==t&&a[o][1]!==e))return 1}(t,o))return 1;a.push([t,o]);var n=Object.keys(t),r=n.length;if(Object.keys(o).length===r){for(;r--;)if(!e(t[n[r]],o[n[r]]))return;return 1}}}(e,t)}var u=new(function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0}var t,o,n;return t=e,(o=[{key:"$on",value:function(e,t){var o=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){o.events[e]=o.events[e].filter(function(e){return t!==e})}}},{key:"$emit",value:function(e,t){e=this.events[e];e&&e.forEach(function(e){return e(t)})}}])&&r(t.prototype,o),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}()),h=["fullscreenControl","geolocationControl","routeEditor","rulerControl","searchControl","trafficControl","typeSelector","zoomControl","routeButtonControl","routePanelControl"];function f(e){return 0===e.filter(function(e){return![].concat(h,["default"]).includes(e)}).length}function y(){var l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,t){if(window.ymaps)return e();var o,n,r,a,i,s,c;document.getElementById("vue-yandex-maps")?u.$on("scriptIsLoaded",e):(o=document.createElement("SCRIPT"),c=void 0===(c=l.apiKey)?"":c,s=l.lang,n=void 0===(n=l.version)?"2.1":n,r=void 0===(r=l.coordorder)?"latlong":r,i=l.debug,a=void 0!==(a=l.enterprise)&&a,i=void 0!==i&&i?"debug":"release",s="lang=".concat(void 0===s?"ru_RU":s).concat(c&&"&apikey=".concat(c),"&mode=").concat(i,"&coordorder=").concat(r),c="https://".concat(a?"enterprise.":"","api-maps.yandex.ru/").concat(n,"/?").concat(s),o.setAttribute("src",c),o.setAttribute("async",""),o.setAttribute("defer",""),o.setAttribute("id","vue-yandex-maps"),document.head.appendChild(o),u.scriptIsNotAttached=!1,o.onload=function(){ymaps.ready(function(){u.ymapReady=!0,u.$emit("scriptIsLoaded"),e()})},o.onerror=t)})}var b=1;var s=u,g=["actionend","balloonclose","balloonopen","click","contextmenu","dblclick","destroy","hintclose","hintopen","optionschange","sizechange","typechange"],c={pluginOptions:{},provide:function(){var t,n,e,r,a,i,s=this,o=[],c=[];return null!=this.balloonComponent&&(r=this.balloonComponent,a=null,i="vue-balloon-".concat(b),b+=1,e=function(e,t){var o=ymaps.templateLayoutFactory.createClass('<div id="'.concat(i,'"><div>'),{build:function(){o.superclass.build.call(this),(a=new(void 0)({parent:e.$root,data:function(){return{props:e.$props,listeners:e.$listeners}},propsData:{marker:t,component:r}})).$mount("#".concat(i))},clear:function(){a.$destroy(),a=null,o.superclass.clear.call(this)}});return o}),{useObjectManager:this.useObjectManager,addMarker:this.addMarker,deleteMarker:function(e){s.myMap.geoObjects&&(o.push(e),t&&clearTimeout(t),t=setTimeout(function(){s.deleteMarkers(o),o=[]},0))},compareValues:function(e){var t=e.newVal,o=e.oldVal,e=e.marker;d(t,o)||(c.push(e),n&&clearTimeout(n),n=setTimeout(function(){s.setMarkers(c),c=[]},0))},makeComponentBalloonTemplate:e}},data:function(){return{ymapId:"yandexMap".concat(Math.round(1e5*Math.random())),style:this.ymapClass?"":"width: 100%; height: 100%;",isReady:!1,debounce:null}},props:{coords:{type:Array,required:!0},zoom:{validator:function(e){return!Number.isNaN(e)},default:18},bounds:Array,clusterOptions:{type:Object,default:function(){return{}}},clusterCallbacks:{type:Object,default:function(){return{}}},behaviors:{type:Array,default:function(){return["default"]}},controls:{type:Array,default:function(){return["default"]},validator:f},detailedControls:{type:Object,validator:function(e){return f(Object.keys(e))}},scrollZoom:{type:Boolean,default:!0},mapType:{type:String,default:"map",validator:function(e){return["map","satellite","hybrid"].includes(e)}},placemarks:{type:Array,default:function(){return[]}},useObjectManager:{type:Boolean,default:!1},objectManagerClusterize:{type:Boolean,default:!0},ymapClass:String,initWithoutMarkers:{type:Boolean,default:!0},debug:{type:Boolean,default:!1},settings:{type:Object,default:function(){return{}}},options:{type:Object,default:function(){return{}}},mapEvents:{type:Array,default:function(){return[]}},showAllMarkers:Boolean,disablePan:Boolean,balloonComponent:{type:[Object,Function],default:function(){return null}},useHtmlInLayout:Boolean},computed:{coordinates:function(){return this.coords.map(function(e){return+e})}},methods:{init:function(){var r=this;this.myMap={},this.markers=[],window.ymaps&&ymaps.GeoObjectCollection&&(this.initWithoutMarkers||this.$slots.default()||this.placemarks.length)&&(this.$emit("map-initialization-started"),this.myMap=new ymaps.Map(this.ymapId,{center:this.coordinates,zoom:+this.zoom,bounds:this.bounds,behaviors:this.behaviors,controls:this.controls,type:"yandex#".concat(this.mapType)},this.options),(this.mapEvents.length?this.mapEvents:g).forEach(function(t){return r.myMap.events.add(t,function(e){return r.$emit(t,e)})}),this.myMap.events.add("boundschange",function(e){var t=e.originalEvent,o=t.newZoom,n=t.newCenter,t=t.newBounds;r.$emit("boundschange",e),r.$emit("update:zoom",o),r.$emit("update:coords",n),r.$emit("update:bounds",t)}),this.detailedControls&&Object.keys(this.detailedControls).forEach(function(e){r.myMap.controls.remove(e),r.myMap.controls.add(e,r.detailedControls[e])}),!1===this.scrollZoom&&this.myMap.behaviors.disable("scrollZoom"),this.isReady=!0,this.$emit("map-was-initialized",this.myMap))},addMarker:function(e){var t=this;this.markers.push(e),this.debounce&&clearTimeout(this.debounce),this.debounce=setTimeout(function(){t.setMarkers(t.markers)},0)},setMarkers:function(e){var t,o=this,n={options:this.clusterOptions,callbacks:this.clusterCallbacks,map:this.myMap,useObjectManager:this.useObjectManager,objectManagerClusterize:this.objectManagerClusterize,useHtmlInLayout:this.useHtmlInLayout};this.markers!==e?(t=e.map(function(e){return o.useObjectManager?e.id:e.properties.get("markerId")}),this.deleteMarkers(t),l(e,n),this.$emit("markers-was-change",t)):l(e,n),this.markers=[],this.showAllMarkers&&this.myMap.setBounds(this.myMap.geoObjects.getBounds())},deleteMarkers:function(a){var i=this,t=[];this.myMap.geoObjects.each(function(e){return t.push(e)}),t.forEach(function(t){var e,o,n,r=[];i.useObjectManager?t.remove(a):(e=function(e){var t=e.properties.get("markerId");a.includes(t)&&r.push(e)},t.each?(t.each(e),o=t.getLength()):t.getGeoObjects&&((n=t.getGeoObjects()).forEach(e),o=n.length),0===o||o===r.length?i.myMap.geoObjects.remove(t):r.length&&r.forEach(function(e){return t.remove(e)}))}),this.$emit("markers-was-delete",a)}},watch:{coordinates:function(e){this.myMap&&(this.disablePan?this.myMap.setCenter&&this.myMap.setCenter(e):this.myMap.panTo&&this.myMap.getZoom()&&this.myMap.panTo(e,{checkZoomRange:!0}))},zoom:function(){this.myMap.setZoom(this.zoom)},bounds:function(e){this.myMap.setBounds&&this.myMap.setBounds(e)}},render:function(){return t.h("section",{class:"ymap-container",ref:"mapContainer"},[t.h("div",{id:this.ymapId,class:this.ymapClass,style:this.style}),this.isReady&&t.h("div",[this.$slots.default()])])},mounted:function(){var e=this;if(this.$attrs["map-link"]||this.$attrs.mapLink)throw new Error("Vue-yandex-maps: Attribute mapLink is not supported. Use settings.");if(this.placemarks&&this.placemarks.length)throw new Error("Vue-yandex-maps: Attribute placemarks is not supported. Use marker component.");this.mapObserver=new MutationObserver(function(){e.myMap.container&&e.myMap.container.fitToViewport()});var t=this.$refs.mapContainer;this.mapObserver.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!1}),s.scriptIsNotAttached&&(t=this.debug,y(n(n(n({},this.$options.pluginOptions),this.settings),{},{debug:t}))),s.ymapReady?ymaps.ready(this.init):s.$on("scriptIsLoaded",this.init)},beforeUnmount:function(){this.myMap.geoObjects&&this.myMap.geoObjects.removeAll()}},k=["placemark","polyline","rectangle","polygon","circle"],v=["balloonclose","balloonopen","click","contextmenu","dblclick","drag","dragend","dragstart","hintclose","hintopen","mouseenter","mouseleave"],O={inject:["useObjectManager","addMarker","deleteMarker","compareValues","makeComponentBalloonTemplate"],props:{coords:Array,hintContent:String,icon:Object,balloon:Object,markerType:{type:String,validator:function(e){return k.includes(e.toLowerCase())},default:"placemark"},markerFill:Object,markerStroke:Object,clusterName:[String,Number],circleRadius:{validator:function(e){return!Number.isNaN(e)},default:1e3},balloonTemplate:String,markerId:{type:[String,Number],required:!0},properties:Object,options:Object,balloonComponentProps:{type:Object,default:function(){return{}}},markerEvents:{type:Array,default:function(){return[]}}},data:function(){return{unwatchArr:[]}},render:function(){return this.$slots.balloon&&t.h("div",{style:"display: none;"},[this.$slots.balloon()])},mounted:function(){var o=this;Object.keys(this.$props).forEach(function(e){"balloonComponentProps"!==e&&o.unwatchArr.push(o.$watch(e,function(e,t){return o.compareValues({newVal:e,oldVal:t,marker:o.defineMarker()})}))}),this.addMarker(this.defineMarker())},methods:{defineMarker:function(){var o=this,e={markerId:this.markerId,markerType:this.markerType||"placemark",coords:function t(e){return e.map(function(e){return Array.isArray(e)?t(e):+e})}(this.coords),hintContent:this.hintContent,markerFill:this.markerFill,circleRadius:+this.circleRadius,clusterName:this.clusterName,markerStroke:this.markerStroke,balloon:this.balloon,properties:this.properties,options:this.options,balloonOptions:{}},t=null,t=(this.balloonTemplate&&(t=ymaps.templateLayoutFactory.createClass(this.balloonTemplate)),this.$slots.balloon&&(t=ymaps.templateLayoutFactory.createClass(this.$slots.balloon()[0].elm.outerHTML)),null!=(t=this.makeComponentBalloonTemplate?this.makeComponentBalloonTemplate(this,e):t)&&(e.balloonOptions.balloonContentLayout=t),this.icon&&["default#image","default#imageWithContent"].includes(this.icon.layout)?(e.iconContent=this.icon.content,e.iconLayout=this.icon.layout,e.iconImageHref=this.icon.imageHref,e.iconImageSize=this.icon.imageSize,e.iconImageOffset=this.icon.imageOffset,e.iconContentOffset=this.icon.contentOffset,this.icon.contentLayout&&"string"==typeof this.icon.contentLayout&&(e.iconContentLayout=ymaps.templateLayoutFactory.createClass(this.icon.contentLayout))):e.icon=this.icon,function(e,t){var o=p(e);if(!t)return o;switch(o){case"Placemark":return"Point";case"Polyline":return"LineString";default:return o}}(e.markerType,this.useObjectManager)),n={hintContent:e.hintContent,iconContent:e.icon?e.icon.content:e.iconContent,markerId:e.markerId},r=e.balloon?{balloonContentHeader:e.balloon.header,balloonContentBody:e.balloon.body,balloonContentFooter:e.balloon.footer}:{},n=Object.assign(n,r,e.properties),a=e.iconLayout?{iconLayout:e.iconLayout,iconImageHref:e.iconImageHref,iconImageSize:e.iconImageSize,iconImageOffset:e.iconImageOffset,iconContentOffset:e.iconContentOffset,iconContentLayout:e.iconContentLayout}:{preset:e.icon&&"islands#".concat((a=(r=e).icon.color||"blue",r=r.icon.glyph?p(r.icon.glyph):r.icon.content?"Stretchy":"",a+r),"Icon")},r=e.markerStroke?{strokeColor:e.markerStroke.color||"0066ffff",strokeOpacity:0<=parseFloat(e.markerStroke.opacity)?parseFloat(e.markerStroke.opacity):1,strokeStyle:e.markerStroke.style,strokeWidth:0<=parseFloat(e.markerStroke.width)?parseFloat(e.markerStroke.width):1}:{},i=e.markerFill?{fill:e.markerFill.enabled||!0,fillColor:e.markerFill.color||"0066ff99",fillOpacity:0<=parseFloat(e.markerFill.opacity)?parseFloat(e.markerFill.opacity):1,fillImageHref:e.markerFill.imageHref||""}:{},r=Object.assign(a,r,i,e.balloonOptions,e.options),i=("Circle"===t&&(e.coords=[e.coords,e.circleRadius]),{properties:n,options:r,markerType:t,coords:e.coords,clusterName:e.clusterName}),s=(n=i,r=this.useObjectManager,this.$emit,(r=r?{type:"Feature",id:n.properties.markerId,geometry:{type:n.markerType,coordinates:n.coords},properties:n.properties,options:n.options}:new ymaps[n.markerType](n.coords,n.properties,n.options)).clusterName=n.clusterName,r);return this.useObjectManager||(this.markerEvents.length?this.markerEvents:v).forEach(function(t){return s.events.add(t,function(e){return o.$emit(t,e)})}),s}},beforeUnmount:function(){this.unwatchArr.forEach(function(e){return e()}),this.deleteMarker(this.markerId)}},C=(c.install=function e(t){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e.installed||(e.installed=!0,c.pluginOptions=o,t.component("yandex-map",c),t.component("ymap-marker",O))},"undefined"!=typeof window&&window.Vue&&window.Vue.use(c),y),j=c,M=O;e.default=c,e.loadYmap=C,e.yandexMap=j,e.ymapMarker=M,Object.defineProperty(e,"__esModule",{value:!0})});
