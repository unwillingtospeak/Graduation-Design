{"version":3,"file":"useFocusDeep.mjs","sources":["../../../../src/composables/useFocusDeep.ts"],"sourcesContent":["import { shallowRef, computed, Ref, onMounted, DefineComponent } from 'vue'\nimport { useHTMLElement } from './useHTMLElement'\nimport { useCaptureEvent } from './useCaptureEvent'\nimport { useCurrentElement } from './useCurrentElement'\n\nconst useActiveElement = () => {\n  const activeEl = shallowRef<HTMLElement>()\n\n  const updateActiveElement = () => {\n    activeEl.value = document.activeElement as HTMLElement\n  }\n\n  onMounted(updateActiveElement)\n\n  useCaptureEvent('focus', updateActiveElement)\n  useCaptureEvent('blur', updateActiveElement)\n\n  return activeEl\n}\n\nexport const useFocusDeep = (el?: Ref<HTMLElement | DefineComponent | undefined>) => {\n  const focused = useActiveElement()\n  const current = useCurrentElement(el ? useHTMLElement(el) : undefined)\n  // Cache previouslyFocusedElement, so we can simply come back to it\n  let previouslyFocusedElement: HTMLElement | null = null\n\n  return computed<boolean | undefined>({\n    get () {\n      if (!focused.value) { return false }\n      if (focused.value === current.value) { return true }\n\n      const isFocused = current.value?.contains(focused.value)\n      if (isFocused) { previouslyFocusedElement = focused.value }\n      return isFocused\n    },\n    set (value) {\n      let target = previouslyFocusedElement ?? current.value\n\n      if (!current.value?.contains(target!)) {\n        target = current.value\n      }\n\n      if (value) {\n        target?.focus()\n      } else {\n        target?.blur()\n      }\n    },\n  })\n}\n"],"names":["useFocusDeep","el","focused","activeEl","shallowRef","updateActiveElement","value","document","activeElement","onMounted","useCaptureEvent","useActiveElement","current","useCurrentElement","useHTMLElement","previouslyFocusedElement","computed","get","isFocused","_a","contains","set","target","focus","blur"],"mappings":"6LAKA,MAeaA,aAAgBC,IAC3B,MAAMC,EAhBiB,MACvB,MAAMC,EAAWC,IAEXC,oBAAsB,KAC1BF,EAASG,MAAQC,SAASC,eAQrB,OALPC,EAAUJ,qBAEVK,EAAgB,QAASL,qBACzBK,EAAgB,OAAQL,qBAEjBF,GAISQ,GACVC,EAAUC,EAAkBZ,EAAKa,EAAeb,QAAM,GAE5D,IAAIc,EAA+C,KAEnD,OAAOC,EAA8B,CACnCC,YACM,IAACf,EAAQI,MAAgB,OAAA,EACzB,GAAAJ,EAAQI,QAAUM,EAAQN,MAAgB,OAAA,EAE9C,MAAMY,EAAY,OAAAC,EAAAP,EAAQN,YAAR,EAAAa,EAAeC,SAASlB,EAAQI,OAE3C,OADHY,IAAaH,EAA2Bb,EAAQI,OAC7CY,GAETG,IAAKf,SACC,IAAAgB,QAASP,IAA4BH,EAAQN,OAE5C,OAAAa,EAAAP,EAAQN,YAAR,EAAAa,EAAeC,SAASE,MAC3BA,EAASV,EAAQN,OAGfA,EACM,MAAAgB,GAAAA,EAAAC,QAEA,MAAAD,GAAAA,EAAAE"}