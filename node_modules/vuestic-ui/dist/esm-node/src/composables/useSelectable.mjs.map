{"version":3,"file":"useSelectable.mjs","sources":["../../../../src/composables/useSelectable.ts"],"sourcesContent":["import { PropType, computed, SetupContext, ShallowRef, ExtractPropTypes } from 'vue'\n\nimport { useStateful, useStatefulProps, StatefulProps } from './useStateful'\nimport { useLoadingProps, LoadingProps } from './useLoading'\nimport { useValidation, useValidationProps, ValidationProps, useValidationEmits } from './useValidation'\nimport { useFocus } from './useFocus'\n\nexport type SelectableProps<V = any> = StatefulProps<V> & LoadingProps & ExtractPropTypes<ValidationProps<V>> & {\n  arrayValue: V | null,\n  label: string,\n  leftLabel: boolean,\n  trueValue: boolean,\n  falseValue: boolean,\n  indeterminate: boolean,\n  indeterminateValue: V | null,\n  disabled: boolean,\n  readonly: boolean,\n}\n\nexport type Elements = {\n  input: ShallowRef<HTMLElement | undefined>,\n  label: ShallowRef<HTMLElement | undefined>,\n  container: ShallowRef<HTMLElement | undefined>,\n}\n\nexport const useSelectableProps = {\n  ...useStatefulProps,\n  ...useLoadingProps,\n  ...useValidationProps,\n  arrayValue: { type: null as any as PropType<unknown>, default: null },\n  label: { type: String, default: '' },\n  leftLabel: { type: Boolean, default: false },\n  trueValue: { type: null as any as PropType<unknown>, default: true },\n  falseValue: { type: null as any as PropType<unknown>, default: false },\n  indeterminate: { type: Boolean, default: false },\n  indeterminateValue: { type: null as any as PropType<unknown>, default: null },\n  disabled: { type: Boolean, default: false },\n  readonly: { type: Boolean, default: false },\n}\n\nexport const useSelectableEmits = [...useValidationEmits, 'update:modelValue', 'focus', 'blur']\n\nconst checkDuplicates = (props: SelectableProps) => {\n  // Just validating state values.\n  const values: unknown[] = [props.falseValue, props.trueValue]\n\n  if (props.indeterminate) {\n    values.push(props.indeterminateValue)\n  }\n\n  const hasDuplicates = new Set(values).size !== values.length\n\n  if (hasDuplicates) {\n    throw new Error('falseValue, trueValue, indeterminateValue props should have strictly different values, which is not the case.')\n  }\n}\n\nexport const useSelectable = (\n  props: SelectableProps,\n  emit: SetupContext['emit'],\n  { input, label, container }: Elements,\n) => {\n  checkDuplicates(props)\n\n  /** @public */\n  const reset = () => emit('update:modelValue', false)\n  const focus = () => input.value?.focus()\n\n  const { computedError, computedErrorMessages, validate, validationAriaAttributes } = useValidation(props, emit, reset, focus)\n  const { valueComputed } = useStateful(props, emit)\n  const { isFocused } = useFocus()\n\n  const isElementRelated = (element: HTMLElement | undefined) => {\n    return !!element && [label.value, container.value].includes(element)\n  }\n  const onBlur = (event: FocusEvent) => {\n    if ((input.value === event.target) && !isElementRelated(event.relatedTarget as HTMLElement)) {\n      isFocused.value = false\n      computedError.value = false\n      validate()\n      emit('blur', event)\n    }\n  }\n  const onFocus = (event: FocusEvent) => {\n    isFocused.value = true\n    emit('focus', event)\n  }\n\n  const isIndeterminate = computed(() => props.indeterminate && valueComputed.value === props.indeterminateValue)\n  const modelIsArray = computed(() => props.arrayValue !== null)\n  const isChecked = computed(() => {\n    if (modelIsArray.value) {\n      return (props.modelValue as unknown[])?.includes(props.arrayValue)\n    }\n\n    return valueComputed.value === props.trueValue\n  })\n  const toggleSelection = () => {\n    if (props.readonly || props.disabled || props.loading) {\n      return\n    }\n\n    // For array access we pretend computedValue does not exist and use modelValue + emit input directly.\n    if (modelIsArray.value) {\n      if (!props.modelValue) {\n        emit('update:modelValue', [props.arrayValue])\n      } else if (!Array.isArray(props.modelValue)) {\n        emit('update:modelValue', props.modelValue === props.arrayValue ? [] : [props.modelValue, props.arrayValue])\n      } else if (props.modelValue.includes(props.arrayValue)) {\n        emit('update:modelValue', props.modelValue.filter((option) => option !== props.arrayValue))\n      } else {\n        emit('update:modelValue', props.modelValue.concat(props.arrayValue))\n      }\n      return\n    }\n\n    if (props.indeterminate) {\n      if (isIndeterminate.value) {\n        valueComputed.value = props.trueValue\n      } else if (isChecked.value) {\n        valueComputed.value = props.falseValue\n      } else {\n        // unchecked\n        valueComputed.value = props.indeterminateValue\n      }\n      return\n    }\n\n    if (isChecked.value) {\n      valueComputed.value = props.falseValue\n    } else {\n      valueComputed.value = props.trueValue\n    }\n  }\n\n  return {\n    isChecked,\n    isIndeterminate,\n    onBlur,\n    onFocus,\n    toggleSelection,\n    reset,\n    focus,\n    computedError,\n    computedErrorMessages,\n    validationAriaAttributes,\n  }\n}\n"],"names":["useSelectableProps","__spreadValues","useStatefulProps","useLoadingProps","useValidationProps","arrayValue","type","default","label","String","leftLabel","Boolean","trueValue","falseValue","indeterminate","indeterminateValue","disabled","readonly","useSelectableEmits","useValidationEmits","useSelectable","props","emit","input","container","values","push","Set","size","length","Error","checkDuplicates","reset","focus","_a","value","computedError","computedErrorMessages","validate","validationAriaAttributes","useValidation","valueComputed","useStateful","isFocused","useFocus","isIndeterminate","computed","modelIsArray","isChecked","modelValue","includes","onBlur","event","element","target","relatedTarget","onFocus","toggleSelection","loading","Array","isArray","filter","option","concat"],"mappings":"2oBAyBO,MAAMA,KAAqBC,eAAAA,eAAAA,eAAA,GAC7BC,GACAC,GACAC,KAH6B,CAIhCC,WAAY,CAAEC,KAAM,KAAkCC,QAAS,MAC/DC,MAAO,CAAEF,KAAMG,OAAQF,QAAS,IAChCG,UAAW,CAAEJ,KAAMK,QAASJ,SAAS,GACrCK,UAAW,CAAEN,KAAM,KAAkCC,SAAS,GAC9DM,WAAY,CAAEP,KAAM,KAAkCC,SAAS,GAC/DO,cAAe,CAAER,KAAMK,QAASJ,SAAS,GACzCQ,mBAAoB,CAAET,KAAM,KAAkCC,QAAS,MACvES,SAAU,CAAEV,KAAMK,QAASJ,SAAS,GACpCU,SAAU,CAAEX,KAAMK,QAASJ,SAAS,uBAG/B,MAAMW,EAAqB,IAAIC,EAAoB,oBAAqB,QAAS,QAiB3EC,cAAgB,CAC3BC,EACAC,GACEC,MAAAA,EAAOf,MAAAA,EAAOgB,UAAAA,MAlBM,CAACH,IAEvB,MAAMI,EAAoB,CAACJ,EAAMR,WAAYQ,EAAMT,WAQnD,GANIS,EAAMP,eACDW,EAAAC,KAAKL,EAAMN,oBAGE,IAAIY,IAAIF,GAAQG,OAASH,EAAOI,OAG9C,MAAA,IAAIC,MAAM,kHASlBC,CAAgBV,GAGhB,MAAMW,MAAQ,IAAMV,EAAK,qBAAqB,GACxCW,MAAQ,WAAM,OAAA,OAAAC,EAAAX,EAAMY,YAAO,EAAAD,EAAAD,UAE3BG,cAAEA,wBAAeC,EAAuBC,SAAAA,EAAAC,yBAAUA,GAA6BC,EAAcnB,EAAOC,EAAMU,MAAOC,QACjHQ,cAAEA,GAAkBC,EAAYrB,EAAOC,IACvCqB,UAAEA,GAAcC,IAkBhBC,EAAkBC,GAAS,IAAMzB,EAAMP,eAAiB2B,EAAcN,QAAUd,EAAMN,qBACtFgC,EAAeD,GAAS,IAA2B,OAArBzB,EAAMhB,aACpC2C,EAAYF,GAAS,WACzB,OAAIC,EAAaZ,MACP,OAAMD,EAAAb,EAAA4B,iBAA0B,EAAAf,EAAAgB,SAAS7B,EAAMhB,YAGlDoC,EAAcN,QAAUd,EAAMT,aAwChC,MAAA,CACLoC,UAAAA,EACAH,gBAAAA,EACAM,OA/DcC,IAHS,IAACC,EAInB9B,EAAMY,QAAUiB,EAAME,SAJHD,EAIgCD,EAAMG,gBAH1C,CAAC/C,EAAM2B,MAAOX,EAAUW,OAAOe,SAASG,KAI1DV,EAAUR,OAAQ,EAClBC,EAAcD,OAAQ,MAEtBb,EAAK,OAAQ8B,KA2DfI,QAxDeJ,IACfT,EAAUR,OAAQ,EAClBb,EAAK,QAAS8B,IAuDdK,gBA3CsB,KAClBpC,EAAMJ,UAAYI,EAAML,UAAYK,EAAMqC,UAK1CX,EAAaZ,MACVd,EAAM4B,WAECU,MAAMC,QAAQvC,EAAM4B,YAErB5B,EAAM4B,WAAWC,SAAS7B,EAAMhB,YACpCiB,EAAA,oBAAqBD,EAAM4B,WAAWY,QAAQC,GAAWA,IAAWzC,EAAMhB,cAE/EiB,EAAK,oBAAqBD,EAAM4B,WAAWc,OAAO1C,EAAMhB,aAJxDiB,EAAK,oBAAqBD,EAAM4B,aAAe5B,EAAMhB,WAAa,GAAK,CAACgB,EAAM4B,WAAY5B,EAAMhB,aAFhGiB,EAAK,oBAAqB,CAACD,EAAMhB,aAWjCgB,EAAMP,cACJ+B,EAAgBV,MAClBM,EAAcN,MAAQd,EAAMT,UACnBoC,EAAUb,MACnBM,EAAcN,MAAQd,EAAMR,WAG5B4B,EAAcN,MAAQd,EAAMN,mBAK5BiC,EAAUb,MACZM,EAAcN,MAAQd,EAAMR,WAE5B4B,EAAcN,MAAQd,EAAMT,YAU9BoB,MAAAA,MACAC,MAAAA,MACAG,cAAAA,EACAC,sBAAAA,EACAE,yBAAAA"}