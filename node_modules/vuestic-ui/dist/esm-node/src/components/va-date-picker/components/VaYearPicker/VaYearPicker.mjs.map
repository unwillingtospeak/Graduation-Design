{"version":3,"file":"VaYearPicker.mjs","sources":["../../../../../../../src/components/va-date-picker/components/VaYearPicker/VaYearPicker.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"rootNode\"\n    class=\"va-year-picker\"\n    v-bind=\"containerAttributes\"\n    @keydown.space.prevent\n  >\n    <va-date-picker-cell\n      v-for=\"(year, index) in years\"\n      :key=\"year.toString()\"\n      :in-range=\"isInRange(year)\"\n      :selected=\"isSelected(year)\"\n      :disabled=\"isYearDisabled(year)\"\n      :today=\"isToday(year)\"\n      :focused=\"focusedCellIndex === index\"\n      :highlight-today=\"highlightToday\"\n      :readonly=\"readonly\"\n      @click=\"onClick(year); focusedCellIndex = index\"\n      @mouseenter=\"hoveredIndex = index\"\n      @mouseleave=\"hoveredIndex = -1\"\n    >\n      {{ year.getFullYear() }}\n    </va-date-picker-cell>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType, toRefs, onMounted, computed, watch, shallowRef } from 'vue'\n\nimport { createYearDate } from '../../utils/date-utils'\nimport { useGridKeyboardNavigation } from '../../hooks/grid-keyboard-navigation'\nimport { useDatePicker } from '../../hooks/use-picker'\n\nimport { DatePickerMode, DatePickerModelValue, DatePickerView } from '../../types'\n\nimport VaDatePickerCell from '../VaDatePickerCell.vue'\n\nexport default defineComponent({\n  name: 'VaYearPicker',\n  components: { VaDatePickerCell },\n\n  props: {\n    modelValue: { type: [Date, Array, Object] as PropType<DatePickerModelValue> },\n    allowedYears: { type: Function as PropType<(date: Date) => boolean>, default: undefined },\n    highlightToday: { type: Boolean, default: true },\n    startYear: { type: Number, default: 1970 },\n    mode: { type: String as PropType<DatePickerMode>, default: 'auto' },\n    view: { type: Object as PropType<DatePickerView>, default: () => ({ type: 'year' }) },\n    endYear: { type: Number, default: () => new Date().getFullYear() + 50 },\n    readonly: { type: Boolean, default: false },\n  },\n\n  emits: ['update:modelValue', 'hover:year', 'click:year'],\n\n  setup (props, { emit }) {\n    const rootNode = shallowRef<HTMLElement>()\n\n    const { view } = toRefs(props)\n\n    const generateYearsArray = (start: number, end: number) => {\n      const yearsCount = end - start + 1\n      return Array.from(Array(yearsCount).keys())\n        .map((i) => createYearDate(start + i))\n    }\n\n    const years = computed(() => generateYearsArray(props.startYear, props.endYear))\n\n    const scrollIntoYearIndex = (index: number) => {\n      if (!rootNode.value) { return }\n\n      const scrollHeight = rootNode.value.scrollHeight\n      const rootNodeHeight = rootNode.value.offsetHeight\n      const currentYearOffset = scrollHeight / years.value.length * index\n      const cellSize = scrollHeight / years.value.length\n      const relativeScrollPosition = currentYearOffset - rootNode.value.scrollTop\n\n      if (relativeScrollPosition < 0) {\n        // First element in view\n        rootNode.value.scrollTo({ top: currentYearOffset })\n      } else if (relativeScrollPosition > rootNodeHeight) {\n        // Last element in view\n        rootNode.value.scrollTo({ top: currentYearOffset - rootNodeHeight + cellSize })\n      }\n    }\n\n    const scrollIntoYearIndexCenter = (index: number) => {\n      if (!rootNode.value) { return }\n\n      const scrollHeight = rootNode.value.scrollHeight\n      const rootNodeHeight = rootNode.value.offsetHeight\n      const currentYearOffset = scrollHeight / years.value.length * index\n\n      rootNode.value.scrollTo({ top: currentYearOffset - rootNodeHeight / 2 })\n    }\n\n    onMounted(() => {\n      const currentYearIndex = years.value.findIndex((date) => date.getFullYear() === view.value.year)\n\n      scrollIntoYearIndexCenter(currentYearIndex)\n    })\n\n    const {\n      hoveredIndex,\n      onClick,\n      isToday,\n      isSelected,\n      isInRange,\n    } = useDatePicker('year', years, props, emit)\n\n    const isYearDisabled = (year: Date) => props.allowedYears === undefined ? false : !props.allowedYears(year)\n\n    const {\n      focusedCellIndex, containerAttributes,\n    } = useGridKeyboardNavigation({\n      rowSize: 1,\n      start: 0,\n      end: years.value.length,\n      onFocusIndex: computed(() => years.value.findIndex((date) => date.getFullYear() === view.value.year)),\n      onSelected: (selectedIndex) => onClick(years.value[selectedIndex]),\n    })\n\n    watch(focusedCellIndex, (index) => index !== -1 && scrollIntoYearIndex(index))\n    watch(focusedCellIndex, (index) => { hoveredIndex.value = index })\n    watch(hoveredIndex, (index) => { focusedCellIndex.value = index })\n\n    return {\n      hoveredIndex,\n      years,\n      rootNode,\n      onClick,\n      isToday,\n      isSelected,\n      isInRange,\n      isYearDisabled,\n      focusedCellIndex,\n      containerAttributes,\n    }\n  },\n})\n</script>\n\n<style lang=\"scss\">\n.va-year-picker {\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n  grid-gap: var(--va-date-picker-cell-gap);\n  max-height: 100%;\n  position: relative;\n}\n</style>\n"],"names":["defineComponent","name","components","VaDatePickerCell","props","modelValue","type","Date","Array","Object","allowedYears","Function","default","highlightToday","Boolean","startYear","Number","mode","String","view","endYear","getFullYear","readonly","emits","setup","emit","rootNode","shallowRef","toRefs","years","computed","start","end","yearsCount","from","keys","map","i","createYearDate","generateYearsArray","onMounted","index","value","scrollHeight","rootNodeHeight","offsetHeight","currentYearOffset","length","scrollTo","top","scrollIntoYearIndexCenter","findIndex","date","year","hoveredIndex","onClick","isToday","isSelected","isInRange","useDatePicker","focusedCellIndex","containerAttributes","useGridKeyboardNavigation","rowSize","onFocusIndex","onSelected","selectedIndex","watch","cellSize","relativeScrollPosition","scrollTop","scrollIntoYearIndex","isYearDisabled","_openBlock","_createElementBlock","_mergeProps","ref","class","_ctx","onKeydown","_cache","_withKeys","_withModifiers","_Fragment","_renderList","_createBlock","_component_va_date_picker_cell","key","toString","selected","disabled","today","focused","$event","onMouseenter","onMouseleave","_createTextVNode","_toDisplayString"],"mappings":"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"}