import{defineComponent as e,shallowRef as r,ref as l,computed as o,watch as s,resolveComponent as t,openBlock as a,createBlock as n,resolveDynamicComponent as i,normalizeClass as u,withCtx as v,renderSlot as c,createElementVNode as d,createVNode as p,createCommentVNode as f}from"vue";import{d as m}from"../../../vendor.mjs";import{s as g}from"../../services/utils.mjs";import{u as b}from"../../composables/useColors.mjs";import"../../composables/useDropdown.mjs";import{u as h}from"./hooks/useScroll.mjs";import{V as y}from"../va-progress-circle/index.mjs";import{_}from"../../../plugin-vue_export-helper.mjs";const S=e({name:"VaInfiniteScroll",components:{VaProgressCircle:y},props:{load:{type:Function,required:!0},offset:{type:Number,default:500},reverse:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},scrollTarget:{type:[String,Object],default:void 0},debounce:{type:Number,default:100},tag:{type:String,default:"div"}},emits:["onload","onerror"],setup(e,{emit:t}){const a=r(),n=r(),i=l(!1),u=l(!1),v=l(!1),c=l(),d=l(0),p=l(0),f=o((()=>{var r;let l;return l="string"==typeof e.scrollTarget?document.querySelector(e.scrollTarget):e.scrollTarget||(null==(r=a.value)?void 0:r.parentElement),l||document.body})),{addScrollListener:y,removeScrollListener:_}=h(e,f,c),{getColor:S}=b(),j=o((()=>u.value?S("danger"):S("primary"))),C=o((()=>{var e;return(null==(e=n.value)?void 0:e.offsetHeight)||0})),T=o((()=>e.offset+C.value)),stop=()=>{e.disabled||(i.value=!1,_())},resume=()=>{e.disabled||y()},onLoad=()=>{const{scrollTop:r,scrollHeight:l,clientHeight:o}=f.value;d.value=l-r;const s=r-p.value;if(p.value=r,e.disabled||u.value||i.value)return;if(v.value)return void(v.value=!1);if(e.reverse&&s>0||!e.reverse&&s<0)return;(e.reverse?r:l-r-o)>T.value||(i.value=!0,e.load().then(finishLoading).catch(onError))},forceSetScrollTopToTarget=e=>{v.value=!0,f.value.scrollTop=e},updateTargetElementScrollTop=()=>{const{scrollTop:r,scrollHeight:l,clientHeight:o}=f.value;if(e.reverse){const e=l-r<d.value,o=r>=C.value;if(e&&o)return;l-d.value>C.value?forceSetScrollTopToTarget(l-d.value):forceSetScrollTopToTarget(C.value)}if(!e.reverse){!(l-r-o>=C.value)&&forceSetScrollTopToTarget(l-o-C.value)}},finishLoading=()=>{updateTargetElementScrollTop(),i.value=!1,t("onload")},stopErrorDisplay=()=>{updateTargetElementScrollTop(),v.value=!1,u.value=!1,i.value=!1,t("onerror")},onError=()=>{stop(),u.value=!0,g(1200).then(stopErrorDisplay).then(resume)};return s((()=>e.debounce),(e=>{c.value=m(onLoad,e)}),{immediate:!0}),s((()=>e.disabled),(e=>{e?stop():resume()})),{element:a,spinnerSlotContainer:n,spinnerColor:j,fetching:i}}}),j={class:"va-infinite-scroll__spinner__default"};var C=_(S,[["render",function _sfc_render(e,r,l,o,s,m){const g=t("va-progress-circle");return a(),n(i(e.$props.tag),{ref:"element",role:"feed",class:u(["va-infinite-scroll",{"va-infinite-scroll--reversed":e.$props.reverse}]),"aria-busy":e.fetching},{default:v((()=>[c(e.$slots,"default"),d("div",{ref:"spinnerSlotContainer",class:u(["va-infinite-scroll__spinner",{"va-infinite-scroll__spinner--invisible":!e.fetching}])},[e.$props.disabled?f("",!0):c(e.$slots,"loading",{key:0},(()=>[d("div",j,[p(g,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,8,["thickness","color"])])]))],2)])),_:3},8,["class","aria-busy"])}]]);export{C as _};

import './VaInfiniteScroll.css';
//# sourceMappingURL=VaInfiniteScroll.mjs.map
