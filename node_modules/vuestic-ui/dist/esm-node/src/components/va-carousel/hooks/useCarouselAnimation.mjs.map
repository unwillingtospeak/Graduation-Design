{"version":3,"file":"useCarouselAnimation.mjs","sources":["../../../../../../src/components/va-carousel/hooks/useCarouselAnimation.ts"],"sourcesContent":["import { computed, onBeforeUnmount, onMounted, ref, Ref, watch } from 'vue'\n\nexport const useCarouselAnimation = (props: {\n  items: any[],\n  autoscrollInterval: number,\n  autoscrollPauseDuration: number,\n  autoscroll: boolean,\n  infinite: boolean,\n  effect: 'fade' | 'transition',\n  vertical: boolean,\n  fadeKeyframe: string,\n}, currentSlide: Ref<number>) => {\n  let animationInterval = -1\n  let direction = 1\n\n  const start = () => {\n    if (!props.autoscroll) { return }\n\n    clearInterval(animationInterval)\n    animationInterval = setInterval(() => {\n      if (props.infinite) {\n        currentSlide.value += 1\n        if (currentSlide.value >= props.items.length) { currentSlide.value = 0 }\n      } else {\n        if (currentSlide.value <= 0) { direction = 1 }\n        if (currentSlide.value >= props.items.length - 1) { direction = -1 }\n        currentSlide.value += direction\n      }\n    }, props.autoscrollInterval) as any\n  }\n\n  let pauseTimeout: number\n  const pause = () => {\n    if (!props.autoscroll) { return }\n\n    clearInterval(animationInterval)\n\n    pauseTimeout = setTimeout(() => {\n      start()\n      clearTimeout(pauseTimeout)\n    }, props.autoscrollPauseDuration) as any\n  }\n\n  const stop = () => {\n    clearInterval(animationInterval)\n    clearTimeout(pauseTimeout)\n  }\n\n  onMounted(() => start())\n  onBeforeUnmount(() => stop())\n\n  const withPause = <T extends (...args: any[]) => any>(fn: T) => {\n    return (...args: Parameters<T>) => { pause(); fn(...args) }\n  }\n\n  const slidesContainerStyle = ref<Record<string, any>>({\n    transition: undefined as string | undefined,\n  })\n\n  /**\n   * Used for infinite loop. In infinite loop additional first item is placed after all items.\n   * Use own currentSlider, which will not update model value if we need to show slide that placed after all items\n   */\n  const sliderToBeShown = ref(0)\n\n  const computedSlidesStyle = computed(() => {\n    if (props.effect === 'fade') {\n      return {\n        ...slidesContainerStyle.value,\n        transition: 'none',\n      }\n    }\n\n    if (props.vertical) {\n      return {\n        ...slidesContainerStyle.value,\n        transform: `translateY(${sliderToBeShown.value * -100}%)`,\n      }\n    }\n\n    return {\n      ...slidesContainerStyle.value,\n      transform: `translateX(${sliderToBeShown.value * -100}%)`,\n    }\n  })\n\n  const animator = {\n    isAnimating: false,\n\n    speed: 0.3,\n\n    order: [] as { to: number, animate?: boolean }[],\n\n    move (from: number, to: number) {\n      const last = props.items.length - 1\n      const firstAfterLast = props.items.length\n\n      if (to === 0 && from === last) {\n        this.order.push({ to: firstAfterLast })\n        this.order.push({ to: 0, animate: false })\n      } else if (to === last && from === 0) {\n        this.order.push({ to: firstAfterLast, animate: false })\n        this.order.push({ to })\n      } else {\n        this.order.push({ to })\n      }\n\n      if (!this.isAnimating) { this.runAnimation() }\n    },\n\n    runAnimation () {\n      this.isAnimating = true\n\n      const animation = this.order.shift()\n\n      if (!animation) { this.isAnimating = false; return }\n\n      sliderToBeShown.value = animation?.to\n\n      if (animation.animate || animation.animate === undefined) {\n        slidesContainerStyle.value.transition = `all ${this.speed}s linear`\n        setTimeout(() => { this.runAnimation() }, this.speed * 1000)\n      } else {\n        slidesContainerStyle.value.transition = 'none'\n        setTimeout(() => { this.runAnimation() }, 16)\n      }\n    },\n  }\n\n  watch(currentSlide, (newValue, oldValue) => {\n    animator.move(oldValue, newValue)\n  })\n\n  /** Animation should control how much slides to display */\n  const slides = computed(() => {\n    if (props.effect === 'fade') {\n      return [props.items[currentSlide.value]]\n    }\n\n    if (props.infinite) {\n      return [...props.items, props.items[0]]\n    }\n\n    return props.items\n  })\n\n  return {\n    start,\n    pause,\n    stop,\n    withPause,\n    computedSlidesStyle,\n    slides,\n  }\n}\n"],"names":["useCarouselAnimation","props","currentSlide","animationInterval","direction","start","autoscroll","clearInterval","setInterval","infinite","value","items","length","autoscrollInterval","pauseTimeout","pause","setTimeout","clearTimeout","autoscrollPauseDuration","stop","onMounted","onBeforeUnmount","slidesContainerStyle","ref","transition","sliderToBeShown","computedSlidesStyle","computed","effect","__spreadProps","__spreadValues","vertical","transform","animator","isAnimating","speed","order","move","from","to","last","firstAfterLast","this","push","animate","runAnimation","animation","shift","watch","newValue","oldValue","slides","withPause","fn","args"],"mappings":"ujBAEa,MAAAA,qBAAuB,CAACC,EASlCC,KACD,IAAIC,GAAoB,EACpBC,EAAY,EAEhB,MAAMC,MAAQ,KACPJ,EAAMK,aAEXC,cAAcJ,GACdA,EAAoBK,aAAY,KAC1BP,EAAMQ,UACRP,EAAaQ,OAAS,EAClBR,EAAaQ,OAAST,EAAMU,MAAMC,SAAUV,EAAaQ,MAAQ,KAEjER,EAAaQ,OAAS,IAAiBN,EAAA,GACvCF,EAAaQ,OAAST,EAAMU,MAAMC,OAAS,IAAiBR,GAAA,GAChEF,EAAaQ,OAASN,KAEvBH,EAAMY,sBAGP,IAAAC,EACJ,MAAMC,MAAQ,KACPd,EAAMK,aAEXC,cAAcJ,GAEdW,EAAeE,YAAW,aAExBC,aAAaH,KACZb,EAAMiB,2BAGLC,KAAO,KACXZ,cAAcJ,GACdc,aAAaH,IAGLM,GAAA,IAAMf,UACAgB,GAAA,IAAMF,SAEhB,MAIAG,EAAuBC,EAAyB,CACpDC,gBAAY,IAORC,EAAkBF,EAAI,GAEtBG,EAAsBC,GAAS,IACd,SAAjB1B,EAAM2B,OACDC,cAAAC,eAAA,GACFR,EAAqBZ,OADnB,CAELc,WAAY,SAIZvB,EAAM8B,SACDF,cAAAC,eAAA,GACFR,EAAqBZ,OADnB,CAELsB,UAAW,eAAsC,IAAxBP,EAAgBf,YAItCmB,cAAAC,eAAA,GACFR,EAAqBZ,OADnB,CAELsB,UAAW,eAAsC,IAAxBP,EAAgBf,cAIvCuB,EAAW,CACfC,aAAa,EAEbC,MAAO,GAEPC,MAAO,GAEPC,KAAMC,EAAcC,GACZ,MAAAC,EAAOvC,EAAMU,MAAMC,OAAS,EAC5B6B,EAAiBxC,EAAMU,MAAMC,OAExB,IAAP2B,GAAYD,IAASE,GACvBE,KAAKN,MAAMO,KAAK,CAAEJ,GAAIE,IACtBC,KAAKN,MAAMO,KAAK,CAAEJ,GAAI,EAAGK,SAAS,KACzBL,IAAOC,GAAiB,IAATF,GACxBI,KAAKN,MAAMO,KAAK,CAAEJ,GAAIE,EAAgBG,SAAS,IAC/CF,KAAKN,MAAMO,KAAK,CAAEJ,GAAAA,KAElBG,KAAKN,MAAMO,KAAK,CAAEJ,GAAAA,IAGfG,KAAKR,aAAeQ,KAAKG,gBAGhCA,eACEH,KAAKR,aAAc,EAEb,MAAAY,EAAYJ,KAAKN,MAAMW,QAExBD,GAELrB,EAAgBf,MAAmB,MAAXoC,OAAW,EAAAA,EAAAP,GAE/BO,EAAUF,cAAiC,IAAtBE,EAAUF,SACZtB,EAAAZ,MAAMc,WAAa,OAAOkB,KAAKP,gBACpDnB,YAAW,KAAQ0B,KAAKG,iBAA+B,IAAbH,KAAKP,SAE/Cb,EAAqBZ,MAAMc,WAAa,OACxCR,YAAW,KAAQ0B,KAAKG,iBAAkB,MAT1BH,KAAKR,aAAc,IAcnCc,EAAA9C,GAAc,CAAC+C,EAAUC,KACpBjB,EAAAI,KAAKa,EAAUD,MAIpB,MAAAE,EAASxB,GAAS,IACD,SAAjB1B,EAAM2B,OACD,CAAC3B,EAAMU,MAAMT,EAAaQ,QAG/BT,EAAMQ,SACD,IAAIR,EAAMU,MAAOV,EAAMU,MAAM,IAG/BV,EAAMU,QAGR,MAAA,CACLN,MAAAA,MACAU,MAAAA,MACAI,KAAAA,KACAiC,UAnGoDC,GAC7C,IAAIC,aAAmCD,KAAMC,IAmGpD5B,oBAAAA,EACAyB,OAAAA"}