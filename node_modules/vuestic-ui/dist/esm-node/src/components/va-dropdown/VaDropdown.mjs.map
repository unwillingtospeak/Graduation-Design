{"version":3,"file":"VaDropdown.mjs","sources":["../../../../../src/components/va-dropdown/VaDropdown.vue"],"sourcesContent":["<template>\n  <div\n    class=\"va-dropdown\"\n    :class=\"computedClass\"\n    ref=\"anchorRef\"\n    role=\"button\"\n    aria-label=\"toggle dropdown\"\n    :aria-disabled=\"$props.disabled\"\n    :aria-expanded=\"!!valueComputed\"\n    :aria-controls=\"idComputed\"\n  >\n    <slot name=\"anchor\" v-bind=\"{ value: valueComputed, hide, show }\" />\n\n    <teleport v-if=\"isMounted\" :to=\"teleportTargetComputed\" :disabled=\"teleportDisabled\">\n      <div\n        v-if=\"valueComputed\"\n        ref=\"contentRef\"\n        class=\"va-dropdown__content-wrapper\"\n        :id=\"idComputed\"\n        @mouseover=\"$props.isContentHoverable && onMouseEnter()\"\n        @mouseout=\"onMouseLeave\"\n        @click.stop=\"emitAndClose('content-click', closeOnContentClick)\"\n      >\n        <slot v-bind=\"{ value: valueComputed, hide, show }\" />\n      </div>\n    </teleport>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, nextTick, PropType, shallowRef, toRef } from 'vue'\nimport pick from 'lodash/pick.js'\nimport kebabCase from 'lodash/kebabCase.js'\n\nimport { generateUniqueId } from '../../services/utils'\n\nimport {\n  useStateful, useStatefulEmits, useStatefulProps,\n  useDebounceFn,\n  useDropdown, placementsPositions, Placement,\n  useClickOutside,\n  useBem,\n  useEvent,\n  useIsMounted,\n  useDocument,\n  useHTMLElement,\n} from '../../composables'\nimport { useAnchorSelector } from './hooks/useAnchorSelector'\nimport { useCursorAnchor } from './hooks/useCursorAnchor'\nimport { useKeyboardNavigation, useMouseNavigation } from './hooks/useDropdownNavigation'\n\nexport default defineComponent({\n  name: 'VaDropdown',\n\n  props: {\n    ...useStatefulProps,\n    stateful: { default: true },\n    modelValue: { type: Boolean, default: false },\n    disabled: { type: Boolean },\n    readonly: { type: Boolean },\n    anchorSelector: { type: String, default: '' },\n    innerAnchorSelector: { type: String, default: '' },\n    /** Element where dropdown content will be rendered */\n    target: { type: String, default: undefined },\n    preventOverflow: { type: Boolean, default: false },\n    keepAnchorWidth: { type: Boolean, default: false },\n    isContentHoverable: { type: Boolean, default: true },\n    closeOnContentClick: { type: Boolean, default: true },\n    closeOnClickOutside: { type: Boolean, default: true },\n    closeOnAnchorClick: { type: Boolean, default: true },\n    hoverOverTimeout: { type: Number, default: 30 },\n    hoverOutTimeout: { type: Number, default: 200 },\n    offset: { type: [Array, Number] as PropType<number | [number, number]>, default: 0 },\n    stickToEdges: { type: Boolean, default: false },\n    autoPlacement: { type: Boolean, default: true },\n    cursor: { type: Boolean, default: false },\n    trigger: {\n      type: String as PropType<'click' | 'right-click' | 'hover' | 'dblclick' | 'none'>,\n      default: 'click',\n      validator: (value: string) => ['click', 'right-click', 'hover', 'dblclick', 'none'].includes(value),\n    },\n    placement: {\n      type: String as PropType<Placement>,\n      default: 'auto',\n      validator: (value: string) => placementsPositions.includes(value),\n    },\n    /** Not reactive */\n    keyboardNavigation: { type: Boolean, default: false },\n  },\n\n  emits: [...useStatefulEmits, 'anchor-click', 'anchor-right-click', 'content-click', 'click-outside', 'close', 'open'],\n\n  setup (props, { emit }) {\n    const contentRef = shallowRef<HTMLElement>()\n\n    const { valueComputed: statefulVal } = useStateful(props, emit)\n    const valueComputed = computed({\n      get: () => statefulVal.value && !props.disabled && !props.readonly,\n      set (val) {\n        statefulVal.value = val\n        if (val) {\n          emit('open')\n        } else {\n          emit('close')\n        }\n      },\n    })\n\n    const computedClass = useBem('va-dropdown', () => pick(props, ['disabled']))\n\n    const { debounced: debounceHover, cancel: cancelHoverDebounce } = useDebounceFn(toRef(props, 'hoverOverTimeout'))\n    const { debounced: debounceUnHover, cancel: cancelUnHoverDebounce } = useDebounceFn(toRef(props, 'hoverOutTimeout'))\n\n    const onMouseEnter = () => {\n      if (props.trigger !== 'hover' || props.disabled) { return }\n\n      debounceHover(() => { valueComputed.value = true })\n      cancelUnHoverDebounce()\n    }\n\n    const onMouseLeave = () => {\n      if (props.trigger !== 'hover' || props.disabled) { return }\n\n      if (props.isContentHoverable) {\n        debounceUnHover(() => { valueComputed.value = false })\n      } else {\n        valueComputed.value = false\n      }\n      cancelHoverDebounce()\n    }\n\n    const emitAndClose = (eventName: string, close?: boolean, e?: Event) => {\n      emit(eventName, e)\n      if (close && props.trigger !== 'none') { valueComputed.value = false }\n    }\n\n    const elRef = useHTMLElement('anchorRef')\n\n    if (props.keyboardNavigation) {\n      useKeyboardNavigation(elRef, valueComputed)\n    }\n\n    useMouseNavigation(elRef, {\n      click (e) {\n        if ((props.trigger !== 'click' && kebabCase(props.trigger) !== 'right-click') || props.disabled) { return }\n\n        if (valueComputed.value) {\n          emitAndClose('anchor-click', props.closeOnAnchorClick, e)\n        } else {\n          if (props.trigger !== 'click') { return }\n          valueComputed.value = true\n          emit('anchor-click', e)\n        }\n      },\n      contextmenu (e) {\n        if (kebabCase(props.trigger) !== 'right-click' || props.disabled) { return }\n        e.preventDefault()\n\n        if (valueComputed.value) {\n          emitAndClose('anchor-right-click', props.closeOnAnchorClick, e)\n\n          if (props.cursor) {\n            nextTick(() => { valueComputed.value = true })\n          }\n        } else {\n          valueComputed.value = true\n          emit('anchor-right-click', e)\n        }\n      },\n      dblclick (e) {\n        if (props.trigger !== 'dblclick' || props.disabled) { return }\n        if (valueComputed.value) {\n          emitAndClose('anchor-dblclick', props.closeOnAnchorClick, e)\n\n          if (props.cursor) {\n            nextTick(() => { valueComputed.value = true })\n          }\n        } else {\n          valueComputed.value = true\n          emit('anchor-dblclick', e)\n        }\n      },\n      mouseenter: onMouseEnter,\n      mouseleave: onMouseLeave,\n    })\n\n    const { anchorRef: computedAnchorRef } = useAnchorSelector(props)\n    useClickOutside([computedAnchorRef, contentRef], () => {\n      if (props.closeOnClickOutside && valueComputed.value) {\n        emitAndClose('click-outside', props.closeOnClickOutside)\n      }\n    })\n\n    const cursorAnchor = useCursorAnchor(computedAnchorRef, valueComputed)\n    useDropdown(computed(() => props.cursor ? cursorAnchor.value : computedAnchorRef.value), contentRef, computed(() => ({\n      placement: props.placement,\n      keepAnchorWidth: props.keepAnchorWidth,\n      offset: props.offset,\n      stickToEdges: props.stickToEdges,\n      autoPlacement: props.autoPlacement,\n      root: teleportTargetComputed.value,\n      viewport: targetComputed.value,\n    })))\n\n    const idComputed = computed(generateUniqueId)\n\n    // useEvent('blur', () => {\n    //   if (props.closeOnClickOutside && valueComputed.value) {\n    //     emitAndClose('click-outside', props.closeOnClickOutside)\n    //   }\n    // })\n\n    const document = useDocument()\n\n    const isPopoverFloating = computed(() => props.preventOverflow || props.cursor)\n\n    const targetComputed = computed(() => {\n      const target = document.value?.querySelector<HTMLElement>(props.target || 'body')\n\n      if (!target) { return document.value?.body }\n\n      if (computedAnchorRef.value && !target.contains(computedAnchorRef.value)) { return document.value?.body }\n\n      return target\n    })\n\n    const teleportTargetComputed = computed(() => {\n      if (!isPopoverFloating.value) {\n        return elRef.value\n      }\n      return targetComputed.value\n    })\n\n    const teleportDisabled = computed(() => props.disabled || !isPopoverFloating.value)\n\n    return {\n      teleportTargetComputed,\n      teleportDisabled,\n      isMounted: useIsMounted(),\n      anchorRef: computedAnchorRef,\n      valueComputed,\n      contentRef,\n      computedClass,\n      idComputed,\n      emitAndClose,\n      onMouseEnter,\n      onMouseLeave,\n      hide: () => { valueComputed.value = false },\n      show: () => { valueComputed.value = true },\n    }\n  },\n})\n</script>\n\n<style lang=\"scss\">\n@import '../../styles/resources';\n@import 'variables';\n\n.va-dropdown {\n  /* Solved the alignment problem (if we try to align inline and block elements) */\n  line-height: var(--va-dropdown-line-height);\n  font-family: var(--va-font-family);\n  display: var(--va-dropdown-display);\n  position: relative;\n  max-width: 100%;\n  vertical-align: middle;\n\n  &--disabled {\n    @include va-disabled;\n  }\n\n  &__content-wrapper {\n    z-index: var(--va-dropdown-content-wrapper-z-index);\n    font-family: var(--va-font-family);\n  }\n}\n</style>\n"],"names":["_sfc_main","defineComponent","name","props","useStatefulProps","stateful","default","modelValue","type","Boolean","disabled","readonly","anchorSelector","String","innerAnchorSelector","target","preventOverflow","keepAnchorWidth","isContentHoverable","closeOnContentClick","closeOnClickOutside","closeOnAnchorClick","hoverOverTimeout","Number","hoverOutTimeout","offset","Array","stickToEdges","autoPlacement","cursor","trigger","validator","value","includes","placement","placementsPositions","keyboardNavigation","emits","useStatefulEmits","setup","emit","contentRef","shallowRef","valueComputed","statefulVal","useStateful","computed","get","set","val","computedClass","useBem","pick","debounced","debounceHover","cancel","cancelHoverDebounce","useDebounceFn","toRef","debounceUnHover","cancelUnHoverDebounce","onMouseEnter","onMouseLeave","emitAndClose","eventName","close","e","elRef","useHTMLElement","useKeyboardNavigation","useMouseNavigation","click","kebabCase","contextmenu","preventDefault","nextTick","dblclick","mouseenter","mouseleave","anchorRef","computedAnchorRef","useAnchorSelector","useClickOutside","cursorAnchor","useCursorAnchor","useDropdown","root","teleportTargetComputed","viewport","targetComputed","idComputed","generateUniqueId","document","useDocument","isPopoverFloating","_a","querySelector","contains","_c","body","_b","teleportDisabled","isMounted","useIsMounted","hide","show","_createElementBlock","class","_normalizeClass","_ctx","ref","role","$props","_renderSlot","$slots","_normalizeProps","_guardReactiveProps","_createBlock","_Teleport","key","to","id","onMouseover","_cache","$event","onMouseout","args","onClick","_withModifiers","_hoisted_2","_createCommentVNode"],"mappings":"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"}