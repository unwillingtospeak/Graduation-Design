{"version":3,"file":"VaForm.mjs","sources":["../../../../../src/components/va-form/VaForm.vue"],"sourcesContent":["<template>\n  <component\n    class=\"va-form\"\n    :is=\"tag\"\n  >\n    <slot />\n  </component>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, Ref, onMounted, onUnmounted, nextTick, provide, inject } from 'vue'\n\nimport { FormServiceKey, FormChild, Form } from './consts'\n\nconst isVaForm = (value: any): value is Form => !!value.focusInvalid\n\nexport default defineComponent({\n  name: 'VaForm',\n  emits: ['validation'],\n  props: {\n    autofocus: { type: Boolean, default: false },\n    tag: { type: String, default: 'div' },\n  },\n\n  setup (props, { emit }) {\n    const nestedFormElements: Ref<(FormChild | Form)[]> = ref([])\n\n    const parentFormProvider = () => inject(FormServiceKey, undefined)\n\n    provide(FormServiceKey, {\n      onChildMounted: (child: FormChild | Form) => childMountedHandler(child),\n      onChildUnmounted: (removableChild: FormChild | Form) => childUnmountedHandler(removableChild),\n    })\n\n    const childMountedHandler = (child: FormChild | Form) => {\n      nestedFormElements.value.push(child)\n    }\n\n    const childUnmountedHandler = (removableChild: FormChild | Form) => {\n      nestedFormElements.value = nestedFormElements.value.filter(child => child !== removableChild)\n    }\n\n    /** @public */\n    const reset = () => {\n      nestedFormElements.value\n        .filter(({ reset }) => reset)\n        .forEach((item) => { item.reset() })\n    }\n\n    const resetValidation = () => {\n      nestedFormElements.value\n        .filter(({ resetValidation }) => resetValidation)\n        .forEach((item: any) => { item.resetValidation() })\n    }\n\n    const focus = () => { nestedFormElements.value.find(({ focus }) => focus)?.focus() }\n\n    const focusInvalid = () => {\n      const invalidComponent = nestedFormElements.value\n        .find((item) => !isVaForm(item) && item.hasError())\n\n      if (invalidComponent) {\n        invalidComponent.focus()\n      } else {\n        nestedFormElements.value\n          .forEach(item => isVaForm(item) && item.focusInvalid())\n      }\n    }\n\n    // validation for every nested child\n    const validate = () => { // NOTE: temporarily synchronous validation\n      const formValid = nestedFormElements.value\n        .filter(({ validate }) => validate)\n        .map((child) => child.validate()) // more readable than with 'forEach'\n        .every((isValid) => isValid)\n\n      emit('validation', formValid)\n\n      return formValid\n    }\n\n    const publicMethods: Form = {\n      reset,\n      resetValidation,\n      focus,\n      focusInvalid,\n      validate,\n    }\n\n    onMounted(() => {\n      parentFormProvider()?.onChildMounted?.(publicMethods)\n\n      if (props.autofocus) { nextTick(focus) }\n    })\n\n    onUnmounted(() => {\n      parentFormProvider()?.onChildUnmounted?.(publicMethods)\n    })\n\n    return publicMethods\n  },\n})\n</script>\n\n<style lang='scss'>\n.va-form {\n  font-family: var(--va-font-family);\n}\n</style>\n"],"names":["isVaForm","value","focusInvalid","defineComponent","name","emits","props","autofocus","type","Boolean","default","tag","String","setup","emit","nestedFormElements","ref","parentFormProvider","inject","FormServiceKey","provide","onChildMounted","child","childMountedHandler","onChildUnmounted","removableChild","childUnmountedHandler","push","filter","focus","_a","find","focus2","publicMethods","reset","reset2","forEach","item","resetValidation","resetValidation2","invalidComponent","hasError","validate","formValid","validate2","map","every","isValid","onMounted","_b","call","nextTick","onUnmounted","_openBlock","_createBlock","_resolveDynamicComponent","_ctx","class","_withCtx","_renderSlot","$slots"],"mappings":"2SAcA,MAAMA,SAAYC,KAAgCA,EAAMC,qBAEtCC,EAAa,CAC7BC,KAAM,SACNC,MAAO,CAAC,cACRC,MAAO,CACLC,UAAW,CAAEC,KAAMC,QAASC,SAAS,GACrCC,IAAK,CAAEH,KAAMI,OAAQF,QAAS,QAGhCG,MAAOP,GAAOQ,KAAEA,IACR,MAAAC,EAAgDC,EAAI,IAEpDC,mBAAqB,IAAMC,EAAOC,OAAgB,GAExDC,EAAQD,EAAgB,CACtBE,eAAiBC,GAA4BC,oBAAoBD,GACjEE,iBAAmBC,GAAqCC,sBAAsBD,KAG1E,MAAAF,oBAAuBD,IACRP,EAAAd,MAAM0B,KAAKL,IAG1BI,sBAAyBD,IAC7BV,EAAmBd,MAAQc,EAAmBd,MAAM2B,QAAON,GAASA,IAAUG,KAgB1EI,MAAQ,WAAQ,OAAmBC,EAAAf,EAAAd,MAAM8B,MAAK,EAAGF,MAAYG,KAAAA,MAAQF,EAAAD,SA0BrEI,EAAsB,CAC1BC,MAvCY,KACOnB,EAAAd,MAChB2B,QAAO,EAAGM,WAAYC,IACtBC,SAASC,IAAWA,EAAKH,YAqC5BI,gBAlCsB,KACHvB,EAAAd,MAChB2B,QAAO,EAAGU,qBAAsBC,IAChCH,SAASC,IAAgBA,EAAKC,sBAgCjCT,MAAAA,MACA3B,aA5BmB,KACnB,MAAMsC,EAAmBzB,EAAmBd,MACzC8B,MAAMM,IAAUrC,SAASqC,IAASA,EAAKI,aAEtCD,EACFA,EAAiBX,QAEEd,EAAAd,MAChBmC,SAAgBC,GAAArC,SAASqC,IAASA,EAAKnC,kBAqB5CwC,SAhBe,KACT,MAAAC,EAAY5B,EAAmBd,MAClC2B,QAAO,EAAGc,cAAeE,IACzBC,KAAKvB,GAAUA,EAAMoB,aACrBI,OAAOC,GAAYA,IAIf,OAFPjC,EAAK,aAAc6B,GAEZA,IAqBF,OAVPK,GAAU,aACW,OAAAC,EAAA,OAAAnB,EAAAb,2BAAG,EAAAa,EAAAT,iBAAiB4B,EAAAC,KAAApB,EAAAG,GAEnC3B,EAAMC,WAAa4C,EAAStB,UAGlCuB,GAAY,aACS,OAAAH,EAAA,OAAAnB,EAAAb,2BAAG,EAAAa,EAAAN,mBAAmByB,EAAAC,KAAApB,EAAAG,MAGpCA,kDAlGToB,OAAAA,IAAAC,EAKYC,EAHLC,EAAA7C,KADL,CAAA8C,MAAM,WAAS,CAAA/C,QAAAgD,GAGf,IAAQ,CAARC,EAAQH,EAAAI,OAAA"}