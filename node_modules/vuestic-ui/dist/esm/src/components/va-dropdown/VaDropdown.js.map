{"version":3,"file":"VaDropdown.js","sources":["../../../../../src/components/va-dropdown/VaDropdown.vue"],"sourcesContent":["<template>\n  <div\n    class=\"va-dropdown\"\n    :class=\"computedClass\"\n    ref=\"anchorRef\"\n    role=\"button\"\n    aria-label=\"toggle dropdown\"\n    :aria-disabled=\"$props.disabled\"\n    :aria-expanded=\"!!valueComputed\"\n    :aria-controls=\"idComputed\"\n  >\n    <slot name=\"anchor\" v-bind=\"{ value: valueComputed, hide, show }\" />\n\n    <teleport v-if=\"isMounted\" :to=\"teleportTargetComputed\" :disabled=\"teleportDisabled\">\n      <div\n        v-if=\"valueComputed\"\n        ref=\"contentRef\"\n        class=\"va-dropdown__content-wrapper\"\n        :id=\"idComputed\"\n        @mouseover=\"$props.isContentHoverable && onMouseEnter()\"\n        @mouseout=\"onMouseLeave\"\n        @click.stop=\"emitAndClose('content-click', closeOnContentClick)\"\n      >\n        <slot v-bind=\"{ value: valueComputed, hide, show }\" />\n      </div>\n    </teleport>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, nextTick, PropType, shallowRef, toRef } from 'vue'\nimport pick from 'lodash/pick.js'\nimport kebabCase from 'lodash/kebabCase.js'\n\nimport { generateUniqueId } from '../../services/utils'\n\nimport {\n  useStateful, useStatefulEmits, useStatefulProps,\n  useDebounceFn,\n  useDropdown, placementsPositions, Placement,\n  useClickOutside,\n  useBem,\n  useEvent,\n  useIsMounted,\n  useDocument,\n  useHTMLElement,\n} from '../../composables'\nimport { useAnchorSelector } from './hooks/useAnchorSelector'\nimport { useCursorAnchor } from './hooks/useCursorAnchor'\nimport { useKeyboardNavigation, useMouseNavigation } from './hooks/useDropdownNavigation'\n\nexport default defineComponent({\n  name: 'VaDropdown',\n\n  props: {\n    ...useStatefulProps,\n    stateful: { default: true },\n    modelValue: { type: Boolean, default: false },\n    disabled: { type: Boolean },\n    readonly: { type: Boolean },\n    anchorSelector: { type: String, default: '' },\n    innerAnchorSelector: { type: String, default: '' },\n    /** Element where dropdown content will be rendered */\n    target: { type: String, default: undefined },\n    preventOverflow: { type: Boolean, default: false },\n    keepAnchorWidth: { type: Boolean, default: false },\n    isContentHoverable: { type: Boolean, default: true },\n    closeOnContentClick: { type: Boolean, default: true },\n    closeOnClickOutside: { type: Boolean, default: true },\n    closeOnAnchorClick: { type: Boolean, default: true },\n    hoverOverTimeout: { type: Number, default: 30 },\n    hoverOutTimeout: { type: Number, default: 200 },\n    offset: { type: [Array, Number] as PropType<number | [number, number]>, default: 0 },\n    stickToEdges: { type: Boolean, default: false },\n    autoPlacement: { type: Boolean, default: true },\n    cursor: { type: Boolean, default: false },\n    trigger: {\n      type: String as PropType<'click' | 'right-click' | 'hover' | 'dblclick' | 'none'>,\n      default: 'click',\n      validator: (value: string) => ['click', 'right-click', 'hover', 'dblclick', 'none'].includes(value),\n    },\n    placement: {\n      type: String as PropType<Placement>,\n      default: 'auto',\n      validator: (value: string) => placementsPositions.includes(value),\n    },\n    /** Not reactive */\n    keyboardNavigation: { type: Boolean, default: false },\n  },\n\n  emits: [...useStatefulEmits, 'anchor-click', 'anchor-right-click', 'content-click', 'click-outside', 'close', 'open'],\n\n  setup (props, { emit }) {\n    const contentRef = shallowRef<HTMLElement>()\n\n    const { valueComputed: statefulVal } = useStateful(props, emit)\n    const valueComputed = computed({\n      get: () => statefulVal.value && !props.disabled && !props.readonly,\n      set (val) {\n        statefulVal.value = val\n        if (val) {\n          emit('open')\n        } else {\n          emit('close')\n        }\n      },\n    })\n\n    const computedClass = useBem('va-dropdown', () => pick(props, ['disabled']))\n\n    const { debounced: debounceHover, cancel: cancelHoverDebounce } = useDebounceFn(toRef(props, 'hoverOverTimeout'))\n    const { debounced: debounceUnHover, cancel: cancelUnHoverDebounce } = useDebounceFn(toRef(props, 'hoverOutTimeout'))\n\n    const onMouseEnter = () => {\n      if (props.trigger !== 'hover' || props.disabled) { return }\n\n      debounceHover(() => { valueComputed.value = true })\n      cancelUnHoverDebounce()\n    }\n\n    const onMouseLeave = () => {\n      if (props.trigger !== 'hover' || props.disabled) { return }\n\n      if (props.isContentHoverable) {\n        debounceUnHover(() => { valueComputed.value = false })\n      } else {\n        valueComputed.value = false\n      }\n      cancelHoverDebounce()\n    }\n\n    const emitAndClose = (eventName: string, close?: boolean, e?: Event) => {\n      emit(eventName, e)\n      if (close && props.trigger !== 'none') { valueComputed.value = false }\n    }\n\n    const elRef = useHTMLElement('anchorRef')\n\n    if (props.keyboardNavigation) {\n      useKeyboardNavigation(elRef, valueComputed)\n    }\n\n    useMouseNavigation(elRef, {\n      click (e) {\n        if ((props.trigger !== 'click' && kebabCase(props.trigger) !== 'right-click') || props.disabled) { return }\n\n        if (valueComputed.value) {\n          emitAndClose('anchor-click', props.closeOnAnchorClick, e)\n        } else {\n          if (props.trigger !== 'click') { return }\n          valueComputed.value = true\n          emit('anchor-click', e)\n        }\n      },\n      contextmenu (e) {\n        if (kebabCase(props.trigger) !== 'right-click' || props.disabled) { return }\n        e.preventDefault()\n\n        if (valueComputed.value) {\n          emitAndClose('anchor-right-click', props.closeOnAnchorClick, e)\n\n          if (props.cursor) {\n            nextTick(() => { valueComputed.value = true })\n          }\n        } else {\n          valueComputed.value = true\n          emit('anchor-right-click', e)\n        }\n      },\n      dblclick (e) {\n        if (props.trigger !== 'dblclick' || props.disabled) { return }\n        if (valueComputed.value) {\n          emitAndClose('anchor-dblclick', props.closeOnAnchorClick, e)\n\n          if (props.cursor) {\n            nextTick(() => { valueComputed.value = true })\n          }\n        } else {\n          valueComputed.value = true\n          emit('anchor-dblclick', e)\n        }\n      },\n      mouseenter: onMouseEnter,\n      mouseleave: onMouseLeave,\n    })\n\n    const { anchorRef: computedAnchorRef } = useAnchorSelector(props)\n    useClickOutside([computedAnchorRef, contentRef], () => {\n      if (props.closeOnClickOutside && valueComputed.value) {\n        emitAndClose('click-outside', props.closeOnClickOutside)\n      }\n    })\n\n    const cursorAnchor = useCursorAnchor(computedAnchorRef, valueComputed)\n    useDropdown(computed(() => props.cursor ? cursorAnchor.value : computedAnchorRef.value), contentRef, computed(() => ({\n      placement: props.placement,\n      keepAnchorWidth: props.keepAnchorWidth,\n      offset: props.offset,\n      stickToEdges: props.stickToEdges,\n      autoPlacement: props.autoPlacement,\n      root: teleportTargetComputed.value,\n      viewport: targetComputed.value,\n    })))\n\n    const idComputed = computed(generateUniqueId)\n\n    // useEvent('blur', () => {\n    //   if (props.closeOnClickOutside && valueComputed.value) {\n    //     emitAndClose('click-outside', props.closeOnClickOutside)\n    //   }\n    // })\n\n    const document = useDocument()\n\n    const isPopoverFloating = computed(() => props.preventOverflow || props.cursor)\n\n    const targetComputed = computed(() => {\n      const target = document.value?.querySelector<HTMLElement>(props.target || 'body')\n\n      if (!target) { return document.value?.body }\n\n      if (computedAnchorRef.value && !target.contains(computedAnchorRef.value)) { return document.value?.body }\n\n      return target\n    })\n\n    const teleportTargetComputed = computed(() => {\n      if (!isPopoverFloating.value) {\n        return elRef.value\n      }\n      return targetComputed.value\n    })\n\n    const teleportDisabled = computed(() => props.disabled || !isPopoverFloating.value)\n\n    return {\n      teleportTargetComputed,\n      teleportDisabled,\n      isMounted: useIsMounted(),\n      anchorRef: computedAnchorRef,\n      valueComputed,\n      contentRef,\n      computedClass,\n      idComputed,\n      emitAndClose,\n      onMouseEnter,\n      onMouseLeave,\n      hide: () => { valueComputed.value = false },\n      show: () => { valueComputed.value = true },\n    }\n  },\n})\n</script>\n\n<style lang=\"scss\">\n@import '../../styles/resources';\n@import 'variables';\n\n.va-dropdown {\n  /* Solved the alignment problem (if we try to align inline and block elements) */\n  line-height: var(--va-dropdown-line-height);\n  font-family: var(--va-font-family);\n  display: var(--va-dropdown-display);\n  position: relative;\n  max-width: 100%;\n  vertical-align: middle;\n\n  &--disabled {\n    @include va-disabled;\n  }\n\n  &__content-wrapper {\n    z-index: var(--va-dropdown-content-wrapper-z-index);\n    font-family: var(--va-font-family);\n  }\n}\n</style>\n"],"names":["pick","kebabCase","_createElementBlock","_normalizeClass","_renderSlot","_normalizeProps","_guardReactiveProps","_createBlock","_Teleport","_openBlock","_withModifiers","_createCommentVNode"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA,MAAK,YAAa,gBAAa;AAAA,EAC7B,MAAM;AAAA,EAEN,OAAO,iCACF,mBADE;AAAA,IAEL,UAAU,EAAE,SAAS,KAAK;AAAA,IAC1B,YAAY,EAAE,MAAM,SAAS,SAAS,MAAM;AAAA,IAC5C,UAAU,EAAE,MAAM,QAAQ;AAAA,IAC1B,UAAU,EAAE,MAAM,QAAQ;AAAA,IAC1B,gBAAgB,EAAE,MAAM,QAAQ,SAAS,GAAG;AAAA,IAC5C,qBAAqB,EAAE,MAAM,QAAQ,SAAS,GAAG;AAAA,IAEjD,QAAQ,EAAE,MAAM,QAAQ,SAAS,OAAU;AAAA,IAC3C,iBAAiB,EAAE,MAAM,SAAS,SAAS,MAAM;AAAA,IACjD,iBAAiB,EAAE,MAAM,SAAS,SAAS,MAAM;AAAA,IACjD,oBAAoB,EAAE,MAAM,SAAS,SAAS,KAAK;AAAA,IACnD,qBAAqB,EAAE,MAAM,SAAS,SAAS,KAAK;AAAA,IACpD,qBAAqB,EAAE,MAAM,SAAS,SAAS,KAAK;AAAA,IACpD,oBAAoB,EAAE,MAAM,SAAS,SAAS,KAAK;AAAA,IACnD,kBAAkB,EAAE,MAAM,QAAQ,SAAS,GAAG;AAAA,IAC9C,iBAAiB,EAAE,MAAM,QAAQ,SAAS,IAAI;AAAA,IAC9C,QAAQ,EAAE,MAAM,CAAC,OAAO,MAAM,GAA0C,SAAS,EAAE;AAAA,IACnF,cAAc,EAAE,MAAM,SAAS,SAAS,MAAM;AAAA,IAC9C,eAAe,EAAE,MAAM,SAAS,SAAS,KAAK;AAAA,IAC9C,QAAQ,EAAE,MAAM,SAAS,SAAS,MAAM;AAAA,IACxC,SAAS;AAAA,MACP,MAAM;AAAA,MACN,SAAS;AAAA,MACT,WAAW,CAAC,UAAkB,CAAC,SAAS,eAAe,SAAS,YAAY,MAAM,EAAE,SAAS,KAAK;AAAA,IACpG;AAAA,IACA,WAAW;AAAA,MACT,MAAM;AAAA,MACN,SAAS;AAAA,MACT,WAAW,CAAC,UAAkB,oBAAoB,SAAS,KAAK;AAAA,IAClE;AAAA,IAEA,oBAAoB,EAAE,MAAM,SAAS,SAAS,MAAM;AAAA,EACtD;AAAA,EAEA,OAAO,CAAC,GAAG,kBAAkB,gBAAgB,sBAAsB,iBAAiB,iBAAiB,SAAS,MAAM;AAAA,EAEpH,MAAO,OAAO,EAAE,QAAQ;AACtB,UAAM,aAAa;AAEnB,UAAM,EAAE,eAAe,gBAAgB,YAAY,OAAO,IAAI;AAC9D,UAAM,gBAAgB,SAAS;AAAA,MAC7B,KAAK,MAAM,YAAY,SAAS,CAAC,MAAM,YAAY,CAAC,MAAM;AAAA,MAC1D,IAAK,KAAK;AACR,oBAAY,QAAQ;AACpB,YAAI,KAAK;AACP,eAAK,MAAM;AAAA,QAAA,OACN;AACL,eAAK,OAAO;AAAA,QACd;AAAA,MACF;AAAA,IAAA,CACD;AAEK,UAAA,gBAAgB,OAAO,eAAe,MAAMA,OAAK,OAAO,CAAC,UAAU,CAAC,CAAC;AAErE,UAAA,EAAE,WAAW,eAAe,QAAQ,wBAAwB,cAAc,MAAM,OAAO,kBAAkB,CAAC;AAC1G,UAAA,EAAE,WAAW,iBAAiB,QAAQ,0BAA0B,cAAc,MAAM,OAAO,iBAAiB,CAAC;AAEnH,UAAM,eAAe,MAAM;AACzB,UAAI,MAAM,YAAY,WAAW,MAAM,UAAU;AAAE;AAAA,MAAO;AAE1D,oBAAc,MAAM;AAAE,sBAAc,QAAQ;AAAA,MAAA,CAAM;AAC5B;IAAA;AAGxB,UAAM,eAAe,MAAM;AACzB,UAAI,MAAM,YAAY,WAAW,MAAM,UAAU;AAAE;AAAA,MAAO;AAE1D,UAAI,MAAM,oBAAoB;AAC5B,wBAAgB,MAAM;AAAE,wBAAc,QAAQ;AAAA,QAAA,CAAO;AAAA,MAAA,OAChD;AACL,sBAAc,QAAQ;AAAA,MACxB;AACoB;IAAA;AAGtB,UAAM,eAAe,CAAC,WAAmB,OAAiB,MAAc;AACtE,WAAK,WAAW,CAAC;AACb,UAAA,SAAS,MAAM,YAAY,QAAQ;AAAE,sBAAc,QAAQ;AAAA,MAAM;AAAA,IAAA;AAGjE,UAAA,QAAQ,eAAe,WAAW;AAExC,QAAI,MAAM,oBAAoB;AAC5B,4BAAsB,OAAO,aAAa;AAAA,IAC5C;AAEA,uBAAmB,OAAO;AAAA,MACxB,MAAO,GAAG;AACH,YAAA,MAAM,YAAY,WAAWC,YAAU,MAAM,OAAO,MAAM,iBAAkB,MAAM,UAAU;AAAE;AAAA,QAAO;AAE1G,YAAI,cAAc,OAAO;AACV,uBAAA,gBAAgB,MAAM,oBAAoB,CAAC;AAAA,QAAA,OACnD;AACD,cAAA,MAAM,YAAY,SAAS;AAAE;AAAA,UAAO;AACxC,wBAAc,QAAQ;AACtB,eAAK,gBAAgB,CAAC;AAAA,QACxB;AAAA,MACF;AAAA,MACA,YAAa,GAAG;AACd,YAAIA,YAAU,MAAM,OAAO,MAAM,iBAAiB,MAAM,UAAU;AAAE;AAAA,QAAO;AAC3E,UAAE,eAAe;AAEjB,YAAI,cAAc,OAAO;AACV,uBAAA,sBAAsB,MAAM,oBAAoB,CAAC;AAE9D,cAAI,MAAM,QAAQ;AAChB,qBAAS,MAAM;AAAE,4BAAc,QAAQ;AAAA,YAAA,CAAM;AAAA,UAC/C;AAAA,QAAA,OACK;AACL,wBAAc,QAAQ;AACtB,eAAK,sBAAsB,CAAC;AAAA,QAC9B;AAAA,MACF;AAAA,MACA,SAAU,GAAG;AACX,YAAI,MAAM,YAAY,cAAc,MAAM,UAAU;AAAE;AAAA,QAAO;AAC7D,YAAI,cAAc,OAAO;AACV,uBAAA,mBAAmB,MAAM,oBAAoB,CAAC;AAE3D,cAAI,MAAM,QAAQ;AAChB,qBAAS,MAAM;AAAE,4BAAc,QAAQ;AAAA,YAAA,CAAM;AAAA,UAC/C;AAAA,QAAA,OACK;AACL,wBAAc,QAAQ;AACtB,eAAK,mBAAmB,CAAC;AAAA,QAC3B;AAAA,MACF;AAAA,MACA,YAAY;AAAA,MACZ,YAAY;AAAA,IAAA,CACb;AAED,UAAM,EAAE,WAAW,sBAAsB,kBAAkB,KAAK;AAChE,oBAAgB,CAAC,mBAAmB,UAAU,GAAG,MAAM;AACjD,UAAA,MAAM,uBAAuB,cAAc,OAAO;AACvC,qBAAA,iBAAiB,MAAM,mBAAmB;AAAA,MACzD;AAAA,IAAA,CACD;AAEK,UAAA,eAAe,gBAAgB,mBAAmB,aAAa;AACzD,gBAAA,SAAS,MAAM,MAAM,SAAS,aAAa,QAAQ,kBAAkB,KAAK,GAAG,YAAY,SAAS,MAAO;AAAA,MACnH,WAAW,MAAM;AAAA,MACjB,iBAAiB,MAAM;AAAA,MACvB,QAAQ,MAAM;AAAA,MACd,cAAc,MAAM;AAAA,MACpB,eAAe,MAAM;AAAA,MACrB,MAAM,uBAAuB;AAAA,MAC7B,UAAU,eAAe;AAAA,MACzB,CAAC;AAEG,UAAA,aAAa,SAAS,gBAAgB;AAQ5C,UAAM,WAAW;AAEjB,UAAM,oBAAoB,SAAS,MAAM,MAAM,mBAAmB,MAAM,MAAM;AAExE,UAAA,iBAAiB,SAAS,MAAM;;AACpC,YAAM,SAAS,eAAS,UAAT,mBAAgB,cAA2B,MAAM,UAAU;AAE1E,UAAI,CAAC,QAAQ;AAAE,eAAO,eAAS,UAAT,mBAAgB;AAAA,MAAK;AAE3C,UAAI,kBAAkB,SAAS,CAAC,OAAO,SAAS,kBAAkB,KAAK,GAAG;AAAE,eAAO,eAAS,UAAT,mBAAgB;AAAA,MAAK;AAEjG,aAAA;AAAA,IAAA,CACR;AAEK,UAAA,yBAAyB,SAAS,MAAM;AACxC,UAAA,CAAC,kBAAkB,OAAO;AAC5B,eAAO,MAAM;AAAA,MACf;AACA,aAAO,eAAe;AAAA,IAAA,CACvB;AAED,UAAM,mBAAmB,SAAS,MAAM,MAAM,YAAY,CAAC,kBAAkB,KAAK;AAE3E,WAAA;AAAA,MACL;AAAA,MACA;AAAA,MACA,WAAW,aAAa;AAAA,MACxB,WAAW;AAAA,MACX;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM,MAAM;AAAE,sBAAc,QAAQ;AAAA,MAAM;AAAA,MAC1C,MAAM,MAAM;AAAE,sBAAc,QAAQ;AAAA,MAAK;AAAA,IAAA;AAAA,EAE7C;AACF,CAAC;;;;sBA1PCC,mBAyBM,OAAA;AAAA,IAxBJ,OAAKC,eAAC,CAAA,eACE,KAAa,aAAA,CAAA;AAAA,IACrB,KAAI;AAAA,IACJ,MAAK;AAAA,IACL,cAAW;AAAA,IACV,iBAAe,KAAO,OAAA;AAAA,IACtB,iBAAa,CAAI,CAAA,KAAA;AAAA,IACjB,iBAAe,KAAA;AAAA,EAAA,GAAA;AAAA,IAEhBC,WAAoE,KAA/B,QAAA,UAAAC,eAAAC,mBAAA,EAAA,OAAA,KAAA,eAAa,MAAE,KAAA,MAAI,MAAE,KAAI,KAAA,CAAA,CAAA,CAAA;AAAA,IAE9C,+BAAhBC,YAYWC,UAAA;AAAA,MAAA,KAAA;AAAA,MAZiB,IAAI,KAAA;AAAA,MAAyB,UAAU,KAAA;AAAA,IAAA,GAAA;AAAA,MAEzD,KAAA,gBAAAC,cADRP,mBAUM,OAAA;AAAA,QAAA,KAAA;AAAA,QARJ,KAAI;AAAA,QACJ,OAAM;AAAA,QACL,IAAI,KAAA;AAAA,QACJ,aAAS,OAAA,MAAA,QAAA,KAAA,CAAA,WAAE,KAAO,OAAA,sBAAsB,KAAY,aAAA;AAAA,QACpD,YAAQ,OAAE,MAAA,QAAA,KAAA,IAAA,SAAA,KAAA,gBAAA,KAAA,aAAA,GAAA,IAAA;AAAA,QACV,SAAK,OAAA,MAAA,QAAA,KAAAQ,cAAA,CAAA,WAAO,KAAY,aAAA,iBAAkB,KAAmB,mBAAA,GAAA,CAAA,MAAA,CAAA;AAAA,MAAA,GAAA;AAAA,QAE9DN,WAAsD,KAA/B,QAAA,WAAAC,eAAAC,mBAAA,EAAA,OAAA,KAAA,eAAa,MAAE,KAAA,MAAI,MAAE,KAAI,KAAA,CAAA,CAAA,CAAA;AAAA,MAAA,GAAA,IAAA,UAAA,KAAAK,mBAAA,IAAA,IAAA;AAAA;;;;;"}