{"version":3,"file":"VaParallax.js","sources":["../../../../../src/components/va-parallax/VaParallax.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"rootElement\"\n    class=\"va-parallax\"\n    :style=\"computedWrapperStyles\"\n  >\n    <div class=\"va-parallax__image-container\">\n      <img\n        ref=\"img\"\n        class=\"va-parallax__image\"\n        :src=\"$props.src\"\n        :alt=\"$props.alt\"\n        :style=\"computedImgStyles\"\n      />\n    </div>\n    <div class=\"va-parallax__item-container\">\n      <slot />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType, ref, computed, onMounted, onBeforeUnmount, shallowRef } from 'vue'\nimport { warn } from '../../services/utils'\n\nexport default defineComponent({\n  name: 'VaParallax',\n  props: {\n    target: { type: [Object, String] as PropType<HTMLElement | string | undefined> },\n    src: { type: String, default: '', required: true },\n    alt: { type: String, default: 'parallax' },\n    height: { type: Number, default: 400 },\n    reversed: { type: Boolean, default: false },\n    speed: {\n      type: Number,\n      default: 0.5,\n      validator: (value: number) => value >= 0 && value <= 1,\n    },\n  },\n  setup (props) {\n    const rootElement = shallowRef<HTMLElement>()\n    const img = shallowRef<HTMLImageElement>()\n\n    const elOffsetTop = ref(0)\n    const parallax = ref(0)\n    const parallaxDist = ref(0)\n    const percentScrolled = ref(0)\n    const scrollTop = ref(0)\n    const windowHeight = ref(0)\n    const windowBottom = ref(0)\n    const isLoaded = ref(false)\n\n    const computedWrapperStyles = computed(() => ({ height: props.height + 'px' }))\n\n    const computedImgStyles = computed(() => ({\n      display: 'block',\n      transform: `translate(-50%, ${parallax.value}px)`,\n      opacity: isLoaded.value ? 1 : 0,\n      top: props.reversed ? 0 : 'auto',\n    }))\n\n    const targetElement = computed(() => {\n      if (!props.target) {\n        return getScrollableParent(rootElement.value?.parentElement)\n      }\n\n      if (props.target instanceof HTMLElement) { // there is a bug if to target passed ref\n        return props.target\n      }\n\n      const element = document.querySelector(props.target)\n\n      if (element) { return element }\n\n      warn('VaParallax target prop got wrong selector. Target is null')\n      return null\n    })\n\n    const getScrollableParent = (element?: HTMLElement | null): HTMLElement | null => {\n      if (!element) {\n        return document.body\n      }\n\n      if (element.scrollHeight > element.clientHeight) {\n        return element\n      }\n\n      return getScrollableParent(element.parentElement)\n    }\n\n    const imgHeight = computed(() => img.value?.naturalHeight || 0)\n\n    const calcDimensions = () => {\n      const offset = rootElement.value?.getBoundingClientRect() || { top: 0 }\n\n      scrollTop.value = targetElement.value?.scrollTop || 0\n      parallaxDist.value = imgHeight.value - props.height\n      elOffsetTop.value = offset.top + scrollTop.value\n      windowHeight.value = window.innerHeight\n      windowBottom.value = scrollTop.value + windowHeight.value\n    }\n\n    const translate = () => {\n      calcDimensions()\n\n      percentScrolled.value = (windowBottom.value - elOffsetTop.value) / (props.height + windowHeight.value)\n\n      parallax.value = Math.round(parallaxDist.value * percentScrolled.value) * props.speed\n\n      if (props.reversed) {\n        parallax.value = -parallax.value\n      }\n    }\n\n    const addEventListeners = () => {\n      targetElement.value?.addEventListener('scroll', translate)\n      targetElement.value?.addEventListener('resize', translate)\n    }\n\n    const removeEventListeners = () => {\n      targetElement.value?.removeEventListener('scroll', translate)\n      targetElement.value?.removeEventListener('resize', translate)\n    }\n\n    const initImage = () => {\n      if (img.value?.complete) {\n        translate()\n        addEventListeners()\n      } else {\n        img.value?.addEventListener('load', () => {\n          translate()\n          addEventListeners()\n        }, false)\n      }\n\n      isLoaded.value = true\n    }\n\n    onMounted(initImage)\n    onBeforeUnmount(removeEventListeners)\n\n    return {\n      img,\n      rootElement,\n      computedWrapperStyles,\n      computedImgStyles,\n    }\n  },\n})\n</script>\n\n<style lang=\"scss\">\n@import \"../../styles/resources\";\n@import \"variables\";\n\n.va-parallax {\n  display: var(--va-parallax-display);\n  position: var(--va-parallax-position);\n  overflow: var(--va-parallax-overflow);\n  width: var(--va-parallax-width);\n  z-index: var(--va-parallax-z-index);\n  font-family: var(--va-font-family);\n\n  &__image-container {\n    position: var(--va-parallax-image-container-position);\n    top: var(--va-parallax-image-container-top);\n    left: var(--va-parallax-image-container-left);\n    right: var(--va-parallax-image-container-right);\n    bottom: var(--va-parallax-image-container-bottom);\n    z-index: var(--va-parallax-image-container-z-index);\n    contain: var(--va-parallax-image-container-contain);\n    user-select: var(--va-parallax-image-container-user-select);\n  }\n\n  &__image {\n    position: var(--va-parallax-image-position);\n    bottom: var(--va-parallax-image-bottom);\n    left: var(--va-parallax-image-left);\n    min-width: var(--va-parallax-image-min-width);\n    min-height: var(--va-parallax-image-min-height);\n    display: var(--va-parallax-image-display);\n    transform: var(--va-parallax-image-transform);\n    will-change: var(--va-parallax-image-will-change);\n    transition: var(--va-parallax-image-transition);\n    z-index: var(--va-parallax-image-z-index);\n  }\n\n  &__item-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 2;\n    contain: strict;\n  }\n}\n</style>\n"],"names":["_createElementBlock","_normalizeStyle","_createElementVNode","_renderSlot"],"mappings":"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"}