{"version":3,"file":"VaForm.js","sources":["../../../../../src/components/va-form/VaForm.vue"],"sourcesContent":["<template>\n  <component\n    class=\"va-form\"\n    :is=\"tag\"\n  >\n    <slot />\n  </component>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, Ref, onMounted, onUnmounted, nextTick, provide, inject } from 'vue'\n\nimport { FormServiceKey, FormChild, Form } from './consts'\n\nconst isVaForm = (value: any): value is Form => !!value.focusInvalid\n\nexport default defineComponent({\n  name: 'VaForm',\n  emits: ['validation'],\n  props: {\n    autofocus: { type: Boolean, default: false },\n    tag: { type: String, default: 'div' },\n  },\n\n  setup (props, { emit }) {\n    const nestedFormElements: Ref<(FormChild | Form)[]> = ref([])\n\n    const parentFormProvider = () => inject(FormServiceKey, undefined)\n\n    provide(FormServiceKey, {\n      onChildMounted: (child: FormChild | Form) => childMountedHandler(child),\n      onChildUnmounted: (removableChild: FormChild | Form) => childUnmountedHandler(removableChild),\n    })\n\n    const childMountedHandler = (child: FormChild | Form) => {\n      nestedFormElements.value.push(child)\n    }\n\n    const childUnmountedHandler = (removableChild: FormChild | Form) => {\n      nestedFormElements.value = nestedFormElements.value.filter(child => child !== removableChild)\n    }\n\n    /** @public */\n    const reset = () => {\n      nestedFormElements.value\n        .filter(({ reset }) => reset)\n        .forEach((item) => { item.reset() })\n    }\n\n    const resetValidation = () => {\n      nestedFormElements.value\n        .filter(({ resetValidation }) => resetValidation)\n        .forEach((item: any) => { item.resetValidation() })\n    }\n\n    const focus = () => { nestedFormElements.value.find(({ focus }) => focus)?.focus() }\n\n    const focusInvalid = () => {\n      const invalidComponent = nestedFormElements.value\n        .find((item) => !isVaForm(item) && item.hasError())\n\n      if (invalidComponent) {\n        invalidComponent.focus()\n      } else {\n        nestedFormElements.value\n          .forEach(item => isVaForm(item) && item.focusInvalid())\n      }\n    }\n\n    // validation for every nested child\n    const validate = () => { // NOTE: temporarily synchronous validation\n      const formValid = nestedFormElements.value\n        .filter(({ validate }) => validate)\n        .map((child) => child.validate()) // more readable than with 'forEach'\n        .every((isValid) => isValid)\n\n      emit('validation', formValid)\n\n      return formValid\n    }\n\n    const publicMethods: Form = {\n      reset,\n      resetValidation,\n      focus,\n      focusInvalid,\n      validate,\n    }\n\n    onMounted(() => {\n      parentFormProvider()?.onChildMounted?.(publicMethods)\n\n      if (props.autofocus) { nextTick(focus) }\n    })\n\n    onUnmounted(() => {\n      parentFormProvider()?.onChildUnmounted?.(publicMethods)\n    })\n\n    return publicMethods\n  },\n})\n</script>\n\n<style lang='scss'>\n.va-form {\n  font-family: var(--va-font-family);\n}\n</style>\n"],"names":["_openBlock","_createBlock","_resolveDynamicComponent","_withCtx","_renderSlot"],"mappings":";;;;AAcA,MAAM,WAAW,CAAC,UAA8B,CAAC,CAAC,MAAM;AAExD,MAAK,YAAa,gBAAa;AAAA,EAC7B,MAAM;AAAA,EACN,OAAO,CAAC,YAAY;AAAA,EACpB,OAAO;AAAA,IACL,WAAW,EAAE,MAAM,SAAS,SAAS,MAAM;AAAA,IAC3C,KAAK,EAAE,MAAM,QAAQ,SAAS,MAAM;AAAA,EACtC;AAAA,EAEA,MAAO,OAAO,EAAE,QAAQ;AAChB,UAAA,qBAAgD,IAAI,CAAA,CAAE;AAE5D,UAAM,qBAAqB,MAAM,OAAO,gBAAgB,MAAS;AAEjE,YAAQ,gBAAgB;AAAA,MACtB,gBAAgB,CAAC,UAA4B,oBAAoB,KAAK;AAAA,MACtE,kBAAkB,CAAC,mBAAqC,sBAAsB,cAAc;AAAA,IAAA,CAC7F;AAEK,UAAA,sBAAsB,CAAC,UAA4B;AACpC,yBAAA,MAAM,KAAK,KAAK;AAAA,IAAA;AAG/B,UAAA,wBAAwB,CAAC,mBAAqC;AAClE,yBAAmB,QAAQ,mBAAmB,MAAM,OAAO,CAAA,UAAS,UAAU,cAAc;AAAA,IAAA;AAI9F,UAAM,QAAQ,MAAM;AACC,yBAAA,MAChB,OAAO,CAAC,EAAE,oBAAY,MAAK,EAC3B,QAAQ,CAAC,SAAS;AAAE,aAAK,MAAM;AAAA,MAAA,CAAG;AAAA,IAAA;AAGvC,UAAM,kBAAkB,MAAM;AACT,yBAAA,MAChB,OAAO,CAAC,EAAE,wCAAsB,gBAAe,EAC/C,QAAQ,CAAC,SAAc;AAAE,aAAK,gBAAgB;AAAA,MAAA,CAAG;AAAA,IAAA;AAGtD,UAAM,QAAQ,MAAM;;AAAE,+BAAmB,MAAM,KAAK,CAAC,EAAE,OAAY,aAAA,MAAK,MAAlD,mBAAqD;AAAA,IAAM;AAEjF,UAAM,eAAe,MAAM;AACzB,YAAM,mBAAmB,mBAAmB,MACzC,KAAK,CAAC,SAAS,CAAC,SAAS,IAAI,KAAK,KAAK,SAAU,CAAA;AAEpD,UAAI,kBAAkB;AACpB,yBAAiB,MAAM;AAAA,MAAA,OAClB;AACc,2BAAA,MAChB,QAAQ,CAAQ,SAAA,SAAS,IAAI,KAAK,KAAK,cAAc;AAAA,MAC1D;AAAA,IAAA;AAIF,UAAM,WAAW,MAAM;AACrB,YAAM,YAAY,mBAAmB,MAClC,OAAO,CAAC,EAAE,0BAAe,SAAQ,EACjC,IAAI,CAAC,UAAU,MAAM,SAAS,CAAC,EAC/B,MAAM,CAAC,YAAY,OAAO;AAE7B,WAAK,cAAc,SAAS;AAErB,aAAA;AAAA,IAAA;AAGT,UAAM,gBAAsB;AAAA,MAC1B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAGF,cAAU,MAAM;;AACK,qCAAA,MAAA,mBAAG,mBAAH,4BAAoB;AAEvC,UAAI,MAAM,WAAW;AAAE,iBAAS,KAAK;AAAA,MAAE;AAAA,IAAA,CACxC;AAED,gBAAY,MAAM;;AACG,qCAAA,MAAA,mBAAG,qBAAH,4BAAsB;AAAA,IAAa,CACvD;AAEM,WAAA;AAAA,EACT;AACF,CAAC;;AApGC,SAAAA,UAAA,GAAAC,YAKYC,wBAHL,KAAA,GAAG,GADR,EAAA,OAAM,aAAS;AAAA,IAAA,SAAAC,QAGf,MAAQ;AAAA,MAARC,WAAQ,KAAA,QAAA,SAAA;AAAA,IAAA,CAAA;AAAA;;;;;"}