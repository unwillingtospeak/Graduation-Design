{"version":3,"file":"useStateful.js","sources":["../../../../src/composables/useStateful.ts"],"sourcesContent":["import { ref, computed, PropType, Ref, watch } from 'vue'\n\nexport type StatefulProps<T> = {\n  stateful: boolean\n  modelValue: T\n}\n\n/**\n * You could add these props to any component by destructuring them inside props option.\n * @example\n * props: { ...useStatefulProps, componentsOwnProp, etc. }\n * It's better to add props at the beginning, to make sure that Component own props will be used instead in case of collision\n */\nexport const useStatefulProps = {\n  stateful: { type: Boolean as PropType<boolean>, default: false },\n  modelValue: { type: undefined as any },\n}\n\nexport const useStatefulEmits = ['update:modelValue']\n\n/**\n * Returns `valueComputed` that is proxy for `modelValue`\n * if `stateful` prop is `false`\n * Record<any, any> & Record<'modelValue', T>\n */\nexport function useStateful<T, D extends T = T> (\n  props: StatefulProps<T>,\n  emit: (event: 'update:modelValue', newValue: T) => void,\n  defaultValue?: D,\n) {\n  const valueState = ref(defaultValue === undefined ? props.modelValue : defaultValue) as Ref<T>\n  let unwatchModelValue: Function\n\n  const watchModelValue = () => {\n    unwatchModelValue = watch(() => props.modelValue, (modelValue) => {\n      valueState.value = modelValue\n    })\n  }\n\n  watch(() => props.stateful, (stateful: boolean) => {\n    stateful ? watchModelValue() : unwatchModelValue?.()\n  }, { immediate: true })\n\n  const valueComputed = computed<T>({\n    get () {\n      if (props.stateful) {\n        return valueState.value\n      }\n      return props.modelValue\n    },\n    set (value: T) {\n      if (props.stateful) {\n        valueState.value = value\n      }\n      emit('update:modelValue', value)\n    },\n  })\n\n  return { valueComputed }\n}\n"],"names":[],"mappings":";AAaO,MAAM,mBAAmB;AAAA,EAC9B,UAAU,EAAE,MAAM,SAA8B,SAAS,MAAM;AAAA,EAC/D,YAAY,EAAE,MAAM,OAAiB;AACvC;AAEa,MAAA,mBAAmB,CAAC,mBAAmB;AAQlD,qBAAA,OACA,MACA,cACA;AACA,QAAM,aAAa,IAAI,iBAAiB,SAAY,MAAM,aAAa,YAAY;AAC/E,MAAA;AAEJ,QAAM,kBAAkB,MAAM;AAC5B,wBAAoB,MAAM,MAAM,MAAM,YAAY,CAAC,eAAe;AAChE,iBAAW,QAAQ;AAAA,IAAA,CACpB;AAAA,EAAA;AAGH,QAAM,MAAM,MAAM,UAAU,CAAC,aAAsB;AACtC,eAAA,oBAAoB;AAAA,EAAoB,GAClD,EAAE,WAAW,KAAA,CAAM;AAEtB,QAAM,gBAAgB,SAAY;AAAA,IAChC,MAAO;AACL,UAAI,MAAM,UAAU;AAClB,eAAO,WAAW;AAAA,MACpB;AACA,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAK,OAAU;AACb,UAAI,MAAM,UAAU;AAClB,mBAAW,QAAQ;AAAA,MACrB;AACA,WAAK,qBAAqB,KAAK;AAAA,IACjC;AAAA,EAAA,CACD;AAED,SAAO,EAAE,cAAc;AACzB;;"}