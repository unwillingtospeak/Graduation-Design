{"version":3,"file":"useFocusDeep.js","sources":["../../../../src/composables/useFocusDeep.ts"],"sourcesContent":["import { shallowRef, computed, Ref, onMounted, DefineComponent } from 'vue'\nimport { useHTMLElement } from './useHTMLElement'\nimport { useCaptureEvent } from './useCaptureEvent'\nimport { useCurrentElement } from './useCurrentElement'\n\nconst useActiveElement = () => {\n  const activeEl = shallowRef<HTMLElement>()\n\n  const updateActiveElement = () => {\n    activeEl.value = document.activeElement as HTMLElement\n  }\n\n  onMounted(updateActiveElement)\n\n  useCaptureEvent('focus', updateActiveElement)\n  useCaptureEvent('blur', updateActiveElement)\n\n  return activeEl\n}\n\nexport const useFocusDeep = (el?: Ref<HTMLElement | DefineComponent | undefined>) => {\n  const focused = useActiveElement()\n  const current = useCurrentElement(el ? useHTMLElement(el) : undefined)\n  // Cache previouslyFocusedElement, so we can simply come back to it\n  let previouslyFocusedElement: HTMLElement | null = null\n\n  return computed<boolean | undefined>({\n    get () {\n      if (!focused.value) { return false }\n      if (focused.value === current.value) { return true }\n\n      const isFocused = current.value?.contains(focused.value)\n      if (isFocused) { previouslyFocusedElement = focused.value }\n      return isFocused\n    },\n    set (value) {\n      let target = previouslyFocusedElement ?? current.value\n\n      if (!current.value?.contains(target!)) {\n        target = current.value\n      }\n\n      if (value) {\n        target?.focus()\n      } else {\n        target?.blur()\n      }\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAKA,MAAM,mBAAmB,MAAM;AAC7B,QAAM,WAAW;AAEjB,QAAM,sBAAsB,MAAM;AAChC,aAAS,QAAQ,SAAS;AAAA,EAAA;AAG5B,YAAU,mBAAmB;AAE7B,kBAAgB,SAAS,mBAAmB;AAC5C,kBAAgB,QAAQ,mBAAmB;AAEpC,SAAA;AACT;AAEa,MAAA,eAAe,CAAC,OAAwD;AACnF,QAAM,UAAU;AAChB,QAAM,UAAU,kBAAkB,KAAK,eAAe,EAAE,IAAI,MAAS;AAErE,MAAI,2BAA+C;AAEnD,SAAO,SAA8B;AAAA,IACnC,MAAO;;AACD,UAAA,CAAC,QAAQ,OAAO;AAAS,eAAA;AAAA,MAAM;AAC/B,UAAA,QAAQ,UAAU,QAAQ,OAAO;AAAS,eAAA;AAAA,MAAK;AAEnD,YAAM,YAAY,cAAQ,UAAR,mBAAe,SAAS,QAAQ;AAClD,UAAI,WAAW;AAAE,mCAA2B,QAAQ;AAAA,MAAM;AACnD,aAAA;AAAA,IACT;AAAA,IACA,IAAK,OAAO;;AACN,UAAA,SAAS,8DAA4B,QAAQ;AAEjD,UAAI,CAAC,eAAQ,UAAR,mBAAe,SAAS,UAAU;AACrC,iBAAS,QAAQ;AAAA,MACnB;AAEA,UAAI,OAAO;AACT,yCAAQ;AAAA,MAAM,OACT;AACL,yCAAQ;AAAA,MACV;AAAA,IACF;AAAA,EAAA,CACD;AACH;;"}